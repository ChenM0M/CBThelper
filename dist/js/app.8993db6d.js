(()=>{"use strict";var t={367:(t,e,s)=>{var o=s(751),a=s(220),n=s(108),i=s(38),l=s(641),r=s(953),c=s(33);const d=s.p+"img/logo.23419aed.png",u={id:"app",class:"app-container"},h={class:"app-header"},g={class:"header-content"},p={class:"logo"},m=["src"],k={class:"nav-links-desktop"},v={class:"app-content"},y={class:"app-footer"},L={__name:"App",setup(t){const e=(0,r.KR)(!1);function s(){e.value=!e.value}return(0,l.sV)((()=>{document.title="CBThelper";const t=document.querySelector("link[rel~='icon']")||document.createElement("link");t.type="image/png",t.rel="icon",t.href="/logo.png",document.head.appendChild(t),console.log("Title and favicon set by App.vue onMounted hook")})),(t,a)=>{const n=(0,l.g2)("router-link"),i=(0,l.g2)("router-view"),L=(0,l.g2)("SpeedInsights");return(0,l.uX)(),(0,l.CE)("div",u,[(0,l.Lk)("header",h,[(0,l.Lk)("div",g,[(0,l.Lk)("div",p,[(0,l.bF)(n,{to:"/"},{default:(0,l.k6)((()=>[(0,l.Lk)("img",{src:(0,r.R1)(d),alt:"CBThelper Logo",class:"logo-image"},null,8,m),a[0]||(a[0]=(0,l.Lk)("span",{class:"logo-text"},"CBThelper",-1))])),_:1})]),(0,l.Lk)("nav",k,[(0,l.bF)(n,{to:"/",class:"nav-link","active-class":"router-link-active"},{default:(0,l.k6)((()=>a[1]||(a[1]=[(0,l.eW)("首页")]))),_:1}),(0,l.bF)(n,{to:"/record",class:"nav-link","active-class":"router-link-active"},{default:(0,l.k6)((()=>a[2]||(a[2]=[(0,l.eW)("记录想法")]))),_:1}),(0,l.bF)(n,{to:"/analysis",class:"nav-link","active-class":"router-link-active"},{default:(0,l.k6)((()=>a[3]||(a[3]=[(0,l.eW)("认知分析")]))),_:1}),(0,l.bF)(n,{to:"/config",class:"nav-link","active-class":"router-link-active"},{default:(0,l.k6)((()=>a[4]||(a[4]=[(0,l.eW)("设置")]))),_:1})]),(0,l.Lk)("button",{class:(0,c.C4)(["nav-toggle-mobile",{"is-active":e.value}]),onClick:s,"aria-label":"Toggle navigation","aria-expanded":"isMobileMenuOpen"},a[5]||(a[5]=[(0,l.Lk)("span",{class:"icon-bar"},null,-1),(0,l.Lk)("span",{class:"icon-bar"},null,-1),(0,l.Lk)("span",{class:"icon-bar"},null,-1)]),2)]),(0,l.Lk)("nav",{class:(0,c.C4)(["nav-links-mobile",{"is-active":e.value}])},[(0,l.bF)(n,{to:"/",class:"nav-link","active-class":"router-link-active",onClick:s},{default:(0,l.k6)((()=>a[6]||(a[6]=[(0,l.eW)("首页")]))),_:1}),(0,l.bF)(n,{to:"/record",class:"nav-link","active-class":"router-link-active",onClick:s},{default:(0,l.k6)((()=>a[7]||(a[7]=[(0,l.eW)("记录想法")]))),_:1}),(0,l.bF)(n,{to:"/analysis",class:"nav-link","active-class":"router-link-active",onClick:s},{default:(0,l.k6)((()=>a[8]||(a[8]=[(0,l.eW)("认知分析")]))),_:1}),(0,l.bF)(n,{to:"/config",class:"nav-link","active-class":"router-link-active",onClick:s},{default:(0,l.k6)((()=>a[9]||(a[9]=[(0,l.eW)("设置")]))),_:1})],2)]),(0,l.Lk)("main",v,[(0,l.bF)(i,null,{default:(0,l.k6)((({Component:t})=>[(0,l.bF)(o.eB,{name:"fade",mode:"out-in"},{default:(0,l.k6)((()=>[((0,l.uX)(),(0,l.Wv)((0,l.$y)(t)))])),_:2},1024)])),_:1})]),(0,l.Lk)("footer",y,[(0,l.Lk)("p",null,"© "+(0,c.v_)((new Date).getFullYear())+" CBT Helper. All rights reserved.",1),a[10]||(a[10]=(0,l.Lk)("p",{class:"disclaimer"},"本工具仅供信息参考和自我辅助，不能替代专业的心理咨询或治疗。如有严重心理困扰，请寻求专业帮助。",-1))]),(0,l.bF)(L)])}}};var b=s(262);const R=(0,b.A)(L,[["__scopeId","data-v-ac6ab4dc"]]),C=R,f={class:"config-container"},E={class:"card"},T={class:"form-group"},x={class:"form-group"},_={class:"form-group"},S={key:0,class:"form-group"},w=["disabled"],X={key:1,class:"alert alert-success mt-3"};function $(t,e,s,a,n,i){return(0,l.uX)(),(0,l.CE)("div",f,[e[11]||(e[11]=(0,l.Lk)("h2",{class:"mb-4"},"🔧 API 设置",-1)),(0,l.Lk)("div",E,[(0,l.Lk)("div",T,[e[6]||(e[6]=(0,l.Lk)("label",null,"API 端点",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=t=>n.apiConfig.endpoint=t),placeholder:"https://api.openai.com/v1/chat/completions"},null,512),[[o.Jo,n.apiConfig.endpoint]])]),(0,l.Lk)("div",x,[e[7]||(e[7]=(0,l.Lk)("label",null,"API 密钥",-1)),(0,l.bo)((0,l.Lk)("input",{type:"password",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=t=>n.apiConfig.apiKey=t),placeholder:"sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"},null,512),[[o.Jo,n.apiConfig.apiKey]])]),(0,l.Lk)("div",_,[e[9]||(e[9]=(0,l.Lk)("label",null,"模型选择",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-control","onUpdate:modelValue":e[2]||(e[2]=t=>n.selectedModelOption=t),onChange:e[3]||(e[3]=(...t)=>i.handleModelChange&&i.handleModelChange(...t))},e[8]||(e[8]=[(0,l.Lk)("option",{value:"gpt-3.5-turbo"},"gpt-3.5-turbo",-1),(0,l.Lk)("option",{value:"gpt-4"},"gpt-4",-1),(0,l.Lk)("option",{value:"gpt-4-turbo"},"gpt-4-turbo",-1),(0,l.Lk)("option",{value:"custom"},"自定义...",-1)]),544),[[o.u1,n.selectedModelOption]])]),"custom"===n.selectedModelOption?((0,l.uX)(),(0,l.CE)("div",S,[e[10]||(e[10]=(0,l.Lk)("label",null,"自定义模型名称",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":e[4]||(e[4]=t=>n.customModelName=t),placeholder:"输入自定义模型名称"},null,512),[[o.Jo,n.customModelName]])])):(0,l.Q3)("",!0),(0,l.Lk)("button",{class:"btn btn-primary",onClick:e[5]||(e[5]=(...t)=>i.saveConfig&&i.saveConfig(...t)),disabled:!i.isFormValid}," 💾 保存设置 ",8,w),n.showSuccess?((0,l.uX)(),(0,l.CE)("div",X," ✅ 设置保存成功！ ")):(0,l.Q3)("",!0)])])}const B={data(){return{apiConfig:{...this.$store.state.apiConfig},showSuccess:!1,selectedModelOption:"",customModelName:""}},created(){const t=["gpt-3.5-turbo","gpt-4","gpt-4-turbo"];t.includes(this.apiConfig.model)?this.selectedModelOption=this.apiConfig.model:(this.selectedModelOption="custom",this.customModelName=this.apiConfig.model)},computed:{isFormValid(){const t=this.apiConfig.endpoint&&this.apiConfig.apiKey;return"custom"===this.selectedModelOption?t&&this.customModelName:t&&this.selectedModelOption}},methods:{handleModelChange(){"custom"!==this.selectedModelOption?this.apiConfig.model=this.selectedModelOption:this.customModelName||(this.customModelName=this.apiConfig.model)},saveConfig(){"custom"===this.selectedModelOption&&(this.apiConfig.model=this.customModelName),this.$store.state.apiConfig=this.apiConfig,this.$store.saveState(),this.showSuccess=!0,setTimeout((()=>this.showSuccess=!1),2e3)}}},I=(0,b.A)(B,[["render",$],["__scopeId","data-v-6c594775"]]),M=I,O={class:"record-container"},F={class:"card thought-form"},Q={class:"form-group"},A={class:"input-icon-wrapper"},W={class:"form-group"},P={class:"input-icon-wrapper"},j={class:"form-group"},N={class:"emotion-tags"},J=["onClick"],K={class:"custom-emotion"},D={class:"emotion-tag-input-container"},V={key:0,class:"selected-emotions"},z=["onClick"],U={class:"form-group"},H={class:"form-label"},q={class:"intensity-value"},Y={class:"intensity-slider"},G={class:"form-actions"},Z=["disabled"],tt={key:0,class:"alert alert-success mt-3 fade-transition"},et={key:0,class:"recent-thoughts"},st={class:"thoughts-list"},ot=["onClick"],at={class:"thought-card-header"},nt={class:"thought-date"},it={class:"thought-emotions"},lt={key:0,class:"emotion-more"},rt={class:"thought-content"},ct={class:"thought-card-footer"},dt={class:"thought-intensity"},ut={class:"intensity-badge"};function ht(t,e,s,a,n,i){const r=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",O,[e[23]||(e[23]=(0,l.Lk)("h2",{class:"section-title"},"📝 记录你的想法",-1)),(0,l.Lk)("div",F,[(0,l.Lk)("form",{onSubmit:e[6]||(e[6]=(0,o.D$)(((...t)=>i.saveRecord&&i.saveRecord(...t)),["prevent"]))},[(0,l.Lk)("div",Q,[e[8]||(e[8]=(0,l.Lk)("label",{class:"form-label"},"情境描述",-1)),(0,l.Lk)("div",A,[e[7]||(e[7]=(0,l.Lk)("span",{class:"input-icon"},"🔍",-1)),(0,l.bo)((0,l.Lk)("textarea",{class:"form-control",rows:"3","onUpdate:modelValue":e[0]||(e[0]=t=>n.newRecord.situation=t),placeholder:"发生了什么？在哪里？什么时候？"},null,512),[[o.Jo,n.newRecord.situation]])])]),(0,l.Lk)("div",W,[e[10]||(e[10]=(0,l.Lk)("label",{class:"form-label"},[(0,l.eW)("自动思维 "),(0,l.Lk)("span",{class:"required"},"*")],-1)),(0,l.Lk)("div",P,[e[9]||(e[9]=(0,l.Lk)("span",{class:"input-icon"},"💭",-1)),(0,l.bo)((0,l.Lk)("textarea",{class:"form-control",rows:"3","onUpdate:modelValue":e[1]||(e[1]=t=>n.newRecord.automaticThought=t),placeholder:"你当时想到了什么？有什么样的想法闪过脑海？",required:""},null,512),[[o.Jo,n.newRecord.automaticThought]])])]),(0,l.Lk)("div",j,[e[11]||(e[11]=(0,l.Lk)("label",{class:"form-label"},"情绪体验",-1)),(0,l.Lk)("div",N,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.commonEmotions,(t=>((0,l.uX)(),(0,l.CE)("button",{type:"button",class:(0,c.C4)(["emotion-tag-btn",{active:n.newRecord.emotions.includes(t)}]),key:t,onClick:e=>i.toggleEmotion(t)},(0,c.v_)(i.getEmotionEmoji(t))+" "+(0,c.v_)(t),11,J)))),128))]),(0,l.Lk)("div",K,[(0,l.Lk)("div",D,[n.customEmotions.length>0?((0,l.uX)(),(0,l.CE)("div",V,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.customEmotions,((t,e)=>((0,l.uX)(),(0,l.CE)("span",{key:e,class:"custom-emotion-tag"},[(0,l.eW)((0,c.v_)(t)+" ",1),(0,l.Lk)("span",{class:"remove-emotion",onClick:t=>i.removeCustomEmotion(e)},"×",8,z)])))),128))])):(0,l.Q3)("",!0),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control emotion-input","onUpdate:modelValue":e[2]||(e[2]=t=>n.currentEmotion=t),placeholder:"输入其他情绪并按Enter添加...",onKeydown:e[3]||(e[3]=(0,o.jR)((0,o.D$)(((...t)=>i.addCustomEmotion&&i.addCustomEmotion(...t)),["prevent"]),["enter"]))},null,544),[[o.Jo,n.currentEmotion]])])])]),(0,l.Lk)("div",U,[(0,l.Lk)("label",H,[e[12]||(e[12]=(0,l.eW)("情绪强度 ")),(0,l.Lk)("span",q,(0,c.v_)(n.newRecord.intensity)+"%",1)]),(0,l.Lk)("div",Y,[e[13]||(e[13]=(0,l.Lk)("span",{class:"intensity-min"},"😌 轻微",-1)),(0,l.bo)((0,l.Lk)("input",{type:"range",class:"custom-range",min:"0",max:"100",step:"5","onUpdate:modelValue":e[4]||(e[4]=t=>n.newRecord.intensity=t)},null,512),[[o.Jo,n.newRecord.intensity,void 0,{number:!0}]]),e[14]||(e[14]=(0,l.Lk)("span",{class:"intensity-max"},"😫 强烈",-1))])]),(0,l.Lk)("div",G,[(0,l.Lk)("button",{type:"submit",class:"btn btn-primary submit-btn",disabled:!i.isFormValid},e[15]||(e[15]=[(0,l.Lk)("span",{class:"btn-icon"},"💾",-1),(0,l.eW)(" 保存记录 ")]),8,Z),(0,l.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[5]||(e[5]=(...t)=>i.resetForm&&i.resetForm(...t))},e[16]||(e[16]=[(0,l.Lk)("span",{class:"btn-icon"},"🔄",-1),(0,l.eW)(" 重置 ")]))]),n.showSuccess?((0,l.uX)(),(0,l.CE)("div",tt,[e[18]||(e[18]=(0,l.eW)(" ✅ 记录保存成功！快去")),(0,l.bF)(r,{to:"/analysis"},{default:(0,l.k6)((()=>e[17]||(e[17]=[(0,l.eW)("分析页面")]))),_:1}),e[19]||(e[19]=(0,l.eW)("看看吧 "))])):(0,l.Q3)("",!0)],32)]),t.$store.state.thoughtRecords.length>0?((0,l.uX)(),(0,l.CE)("div",et,[e[22]||(e[22]=(0,l.Lk)("h3",{class:"subsection-title"},"最近记录",-1)),(0,l.Lk)("div",st,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.recentThoughts,((t,s)=>((0,l.uX)(),(0,l.CE)("div",{class:"thought-card",key:s,onClick:t=>i.goToAnalysis(s)},[(0,l.Lk)("div",at,[(0,l.Lk)("span",nt,(0,c.v_)(i.formatDate(t.timestamp)),1),(0,l.Lk)("div",it,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(t.emotions.slice(0,2),((t,e)=>((0,l.uX)(),(0,l.CE)("span",{key:e,class:"emotion-badge"},(0,c.v_)(t),1)))),128)),t.emotions.length>2?((0,l.uX)(),(0,l.CE)("span",lt,"+"+(0,c.v_)(t.emotions.length-2),1)):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",rt,(0,c.v_)(i.truncateText(t.automaticThought,100)),1),(0,l.Lk)("div",ct,[(0,l.Lk)("div",dt,[e[20]||(e[20]=(0,l.eW)(" 强度: ")),(0,l.Lk)("span",ut,(0,c.v_)(t.intensity)+"%",1)]),e[21]||(e[21]=(0,l.Lk)("span",{class:"view-analysis"},"查看分析 →",-1))])],8,ot)))),128))])])):(0,l.Q3)("",!0)])}const gt={data(){return{newRecord:{situation:"",automaticThought:"",emotions:[],customEmotion:"",intensity:50,timestamp:null},commonEmotions:["焦虑","沮丧","愤怒","悲伤","羞愧","兴奋","平静","恐惧","失落","担忧"],showSuccess:!1,currentEmotion:"",customEmotions:[]}},computed:{isFormValid(){return this.newRecord.automaticThought.trim()&&this.newRecord.intensity>0},recentThoughts(){return this.$store.state.thoughtRecords.slice(0,3)}},methods:{getEmotionEmoji(t){const e={焦虑:"😰",沮丧:"😔",愤怒:"😠",悲伤:"😢",羞愧:"😳",兴奋:"😃",平静:"😌",恐惧:"😨",失落:"😞",担忧:"😟"};return e[t]||"😶"},toggleEmotion(t){const e=this.newRecord.emotions.indexOf(t);-1===e?this.newRecord.emotions.push(t):this.newRecord.emotions.splice(e,1)},addCustomEmotion(){const t=this.currentEmotion.trim();t&&!this.customEmotions.includes(t)&&(this.customEmotions.push(t),this.currentEmotion="")},removeCustomEmotion(t){this.customEmotions.splice(t,1)},saveRecord(){const t={...this.newRecord,timestamp:(new Date).toISOString(),emotions:[...this.newRecord.emotions,...this.customEmotions]};this.$store.state.thoughtRecords.unshift(t),this.$store.saveState(),void 0!==this.$store.selectedRecordIndex&&(this.$store.selectedRecordIndex=0),this.showSuccess=!0,setTimeout((()=>{this.showSuccess=!1,this.resetForm()}),3e3)},resetForm(){this.newRecord={situation:"",automaticThought:"",emotions:[],customEmotion:"",intensity:50,timestamp:null},this.currentEmotion="",this.customEmotions=[]},formatDate(t){return t?new Date(t).toLocaleString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"未知时间"},truncateText(t,e){return t?t.length>e?t.substring(0,e)+"...":t:""},goToAnalysis(t){this.$router.push("/analysis"),this.$store.selectedRecordIndex=t}}},pt=(0,b.A)(gt,[["render",ht],["__scopeId","data-v-13f438a3"]]),mt=pt,kt={class:"analysis-container"},vt={class:"history-selector mb-4"},yt={class:"history-header"},Lt=["value"],bt={key:0,class:"history-manager"},Rt={class:"history-manager-content"},Ct={class:"history-manager-header"},ft={class:"history-manager-body"},Et={class:"history-list"},Tt={class:"history-item-content"},xt={class:"history-item-date"},_t={class:"history-item-thought"},St={class:"history-item-actions"},wt=["onClick"],Xt={key:0,class:"no-records"},$t={class:"history-manager-footer"},Bt={key:1,class:"card"},It={class:"analysis-section"},Mt={class:"thought-text"},Ot={key:0,class:"situation-box"},Ft={class:"situation-text"},Qt={class:"meta-info"},At={class:"date-tag"},Wt={class:"emotion-badges"},Pt={class:"analysis-section"},jt={key:0,class:"bias-tags"},Nt=["onClick"],Jt={class:"confidence"},Kt={key:1,class:"no-biases"},Dt={key:0},Vt={key:1,class:"bias-tips"},zt={key:2},Ut={key:2,class:"bias-evidence"},Ht={class:"evidence-header"},qt={class:"evidence-text"},Yt={class:"analysis-section"},Gt={class:"question-list"},Zt={key:0,class:"no-questions"},te={class:"analysis-section"},ee={key:0,class:"analysis-section"},se={class:"alternative-thought"},oe={class:"feedback-buttons"},ae={key:1,class:"action-buttons"},ne={key:2,class:"loading-container"},ie={class:"progress"},le={class:"loading-text"},re={key:0,class:"loading-tips"},ce={key:3,class:"api-error alert alert-danger"},de={class:"mt-2"},ue={key:2,class:"alert alert-warning"};function he(t,e,s,a,n,i){const r=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",kt,[e[23]||(e[23]=(0,l.Lk)("h2",{class:"section-title"},"🔍 认知分析",-1)),(0,l.Lk)("div",vt,[(0,l.Lk)("div",yt,[e[11]||(e[11]=(0,l.Lk)("label",{for:"recordSelect"},"选择记录:",-1)),(0,l.Lk)("button",{class:"btn btn-sm btn-outline-secondary",onClick:e[0]||(e[0]=t=>n.showHistoryManager=!0)},e[10]||(e[10]=[(0,l.Lk)("span",{class:"btn-icon"},"📋",-1),(0,l.eW)(" 管理历史记录 ")]))]),(0,l.bo)((0,l.Lk)("select",{id:"recordSelect",class:"form-select","onUpdate:modelValue":e[1]||(e[1]=t=>n.selectedRecordIndex=t),onChange:e[2]||(e[2]=(...t)=>i.loadSelectedRecord&&i.loadSelectedRecord(...t))},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(t.$store.state.thoughtRecords,((t,e)=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,c.v_)(i.formatTimestamp(t.timestamp))+" - "+(0,c.v_)(i.truncateText(t.automaticThought,30)),9,Lt)))),128))],544),[[o.u1,n.selectedRecordIndex]])]),n.showHistoryManager?((0,l.uX)(),(0,l.CE)("div",bt,[(0,l.Lk)("div",Rt,[(0,l.Lk)("div",Ct,[e[12]||(e[12]=(0,l.Lk)("h3",null,"管理历史记录",-1)),(0,l.Lk)("button",{class:"btn-close",onClick:e[3]||(e[3]=t=>n.showHistoryManager=!1)},"×")]),(0,l.Lk)("div",ft,[(0,l.Lk)("div",Et,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(t.$store.state.thoughtRecords,((t,e)=>((0,l.uX)(),(0,l.CE)("div",{key:e,class:"history-item"},[(0,l.Lk)("div",Tt,[(0,l.Lk)("div",xt,(0,c.v_)(i.formatTimestamp(t.timestamp)),1),(0,l.Lk)("div",_t,(0,c.v_)(i.truncateText(t.automaticThought,60)),1),(0,l.Lk)("div",{class:(0,c.C4)(["history-item-status",i.getRecordStatusClass(t)])},(0,c.v_)(i.getRecordStatus(t)),3)]),(0,l.Lk)("div",St,[(0,l.Lk)("button",{class:"btn btn-sm btn-outline-danger",onClick:t=>i.deleteRecord(e),title:"删除记录"}," 🗑️ ",8,wt)])])))),128)),0===t.$store.state.thoughtRecords.length?((0,l.uX)(),(0,l.CE)("div",Xt," 暂无历史记录 ")):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",$t,[(0,l.Lk)("button",{class:"btn btn-outline-secondary",onClick:e[4]||(e[4]=t=>n.showHistoryManager=!1)},"关闭")])])])):(0,l.Q3)("",!0),n.currentRecord?((0,l.uX)(),(0,l.CE)("div",Bt,[(0,l.Lk)("div",It,[e[14]||(e[14]=(0,l.Lk)("h5",null,"📌 你的自动思维",-1)),(0,l.Lk)("p",Mt,'"'+(0,c.v_)(n.currentRecord.automaticThought)+'"',1),n.currentRecord.situation?((0,l.uX)(),(0,l.CE)("div",Ot,[e[13]||(e[13]=(0,l.Lk)("h6",null,"🔍 情境描述",-1)),(0,l.Lk)("p",Ft,(0,c.v_)(n.currentRecord.situation),1)])):(0,l.Q3)("",!0),(0,l.Lk)("div",Qt,[(0,l.Lk)("span",At,(0,c.v_)(i.formatTimestamp(n.currentRecord.timestamp)),1),(0,l.Lk)("div",Wt,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.currentRecord.emotions,((t,e)=>((0,l.uX)(),(0,l.CE)("span",{key:e,class:"emotion-badge"},(0,c.v_)(t),1)))),128))])])]),(0,l.Lk)("div",Pt,[e[16]||(e[16]=(0,l.Lk)("h5",null,"🧠 识别到的认知偏差",-1)),n.analysisResult.cognitiveBiases&&n.analysisResult.cognitiveBiases.length>0?((0,l.uX)(),(0,l.CE)("div",jt,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.analysisResult.cognitiveBiases,(t=>((0,l.uX)(),(0,l.CE)("span",{class:"badge badge-pill",key:t.type,style:(0,c.Tr)({backgroundColor:i.getBiasColor(t.type)}),onClick:e=>i.selectBias(t)},[(0,l.eW)((0,c.v_)(t.type)+" ",1),(0,l.Lk)("span",Jt,"("+(0,c.v_)(t.confidence)+"%)",1)],12,Nt)))),128))])):((0,l.uX)(),(0,l.CE)("div",Kt,[n.analyzedOnce?((0,l.uX)(),(0,l.CE)("p",Dt,"系统未检测到明显的认知偏差，但这并不意味着思维完全没有问题。 请继续浏览下方的引导性问题，思考自己的想法是否存在这些情况：")):(0,l.Q3)("",!0),n.analyzedOnce?((0,l.uX)(),(0,l.CE)("ul",Vt,e[15]||(e[15]=[(0,l.Lk)("li",null,"你是否在考虑最糟糕的可能性？",-1),(0,l.Lk)("li",null,'你是否在用"非黑即白"的方式看待情况？',-1),(0,l.Lk)("li",null,"你是否从单一事件得出了普遍性结论？",-1),(0,l.Lk)("li",null,"你是否用情绪而非事实在做判断？",-1),(0,l.Lk)("li",null,"你是否给自己或他人设置了过高标准？",-1)]))):((0,l.uX)(),(0,l.CE)("p",zt,'暂未识别到认知偏差，请点击"开始分析"进行分析。'))])),n.selectedBias?((0,l.uX)(),(0,l.CE)("div",Ut,[(0,l.Lk)("div",Ht,[(0,l.Lk)("h6",null,(0,c.v_)(n.selectedBias.type)+" 的识别依据：",1)]),(0,l.Lk)("p",qt,(0,c.v_)(n.selectedBias.evidence),1)])):(0,l.Q3)("",!0)]),(0,l.Lk)("div",Yt,[e[17]||(e[17]=(0,l.Lk)("h5",null,"💡 引导性问题",-1)),(0,l.Lk)("ul",Gt,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.analysisResult.guidingQuestions,((t,e)=>((0,l.uX)(),(0,l.CE)("li",{key:e},(0,c.v_)(t),1)))),128))]),n.analysisResult.guidingQuestions&&0!==n.analysisResult.guidingQuestions.length?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",Zt,' 暂无引导性问题，请点击"开始分析"生成问题。 '))]),(0,l.Lk)("div",te,[e[18]||(e[18]=(0,l.Lk)("h5",null,"📝 你的思考记录",-1)),(0,l.bo)((0,l.Lk)("textarea",{class:"form-control",rows:"4","onUpdate:modelValue":e[5]||(e[5]=t=>n.userResponse=t),placeholder:"请写下你对这些问题的思考..."},null,512),[[o.Jo,n.userResponse]])]),n.alternativeThought?((0,l.uX)(),(0,l.CE)("div",ee,[e[19]||(e[19]=(0,l.Lk)("h5",null,"🌈 建议的替代想法",-1)),(0,l.Lk)("p",se,'"'+(0,c.v_)(n.alternativeThought)+'"',1),(0,l.Lk)("div",oe,[(0,l.Lk)("button",{class:"btn btn-success mr-2",onClick:e[6]||(e[6]=(...t)=>i.saveAlternativeThought&&i.saveAlternativeThought(...t))}," 👍 保存这个想法 "),(0,l.Lk)("button",{class:"btn btn-outline-secondary",onClick:e[7]||(e[7]=(...t)=>i.generateAlternativeThought&&i.generateAlternativeThought(...t))}," 🔄 重新生成 ")])])):(0,l.Q3)("",!0),n.isLoading?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",ae,[(0,l.Lk)("button",{class:"btn btn-primary",onClick:e[8]||(e[8]=(...t)=>i.analyzeThought&&i.analyzeThought(...t))},e[20]||(e[20]=[(0,l.Lk)("span",{class:"icon"},"🧠",-1),(0,l.eW)(" 开始分析 ")]))])),n.isLoading?((0,l.uX)(),(0,l.CE)("div",ne,[(0,l.Lk)("div",ie,[(0,l.Lk)("div",{class:(0,c.C4)(["progress-bar",{"progress-bar-animated":n.isLoading}]),style:(0,c.Tr)({width:`${n.loadingProgress}%`})},(0,c.v_)(n.loadingStage),7)]),(0,l.Lk)("p",le,(0,c.v_)(n.loadingStage)+" ("+(0,c.v_)(n.loadingProgress)+"%)",1),n.loadingTip?((0,l.uX)(),(0,l.CE)("p",re,(0,c.v_)(n.loadingTip),1)):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0),n.apiError?((0,l.uX)(),(0,l.CE)("div",ce,[e[22]||(e[22]=(0,l.Lk)("p",null,[(0,l.Lk)("strong",null,"分析过程中发生错误")],-1)),(0,l.Lk)("p",null,(0,c.v_)(n.apiError),1),(0,l.Lk)("p",de,[(0,l.Lk)("button",{class:"btn btn-sm btn-outline-danger",onClick:e[9]||(e[9]=t=>n.apiError=null)},"关闭"),(0,l.bF)(r,{to:"/config",class:"btn btn-sm btn-primary ml-2"},{default:(0,l.k6)((()=>e[21]||(e[21]=[(0,l.eW)("检查API设置")]))),_:1})])])):(0,l.Q3)("",!0)])):((0,l.uX)(),(0,l.CE)("div",ue," ⚠️ 请先完成至少一条思想记录 "))])}var ge=s(335);const pe={data(){return{selectedRecordIndex:0,currentRecord:null,analysisResult:{cognitiveBiases:[],guidingQuestions:[]},userResponse:"",alternativeThought:"",isLoading:!1,loadingProgress:0,loadingStage:"准备分析",loadingTip:"",apiError:null,showHistoryManager:!1,selectedBias:null,analyzedOnce:!1,loadingTips:["认知偏差是我们思维中的盲点，识别它们是治疗的第一步...","苏格拉底式提问帮助我们挑战自己的想法，促进更深入的思考...","替代性思维不是简单地积极思考，而是寻找更平衡的视角...","认知行为疗法强调思维、情绪和行为之间的联系...","改变想法不是一蹴而就的，需要持续的练习和耐心..."]}},computed:{apiConfig(){return this.$store.state.apiConfig}},mounted(){void 0!==this.$store.selectedRecordIndex?(this.selectedRecordIndex=this.$store.selectedRecordIndex,this.$store.selectedRecordIndex=void 0):this.$store.state.thoughtRecords.length>0&&(this.selectedRecordIndex=0),this.loadSelectedRecord()},methods:{formatTimestamp(t){return t?new Date(t).toLocaleString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"未知时间"},truncateText(t,e){return t?t.length>e?t.substring(0,e)+"...":t:""},loadSelectedRecord(){if(0===this.$store.state.thoughtRecords.length)return void(this.currentRecord=null);const t=this.$store.state.thoughtRecords[this.selectedRecordIndex];this.currentRecord=t,t.analysisResult?this.analysisResult=t.analysisResult:this.analysisResult={cognitiveBiases:[],guidingQuestions:[]},t.userResponse?this.userResponse=t.userResponse:this.userResponse="",this.alternativeThought=t.alternativeThought||"",this.selectedBias=null},getBiasColor(t){const e={灾难化:"#ff6b6b",非黑即白:"#4ecdc4",过度概括:"#45b7d1",情绪推理:"#96ceb4",应该陈述:"#ffeead",心理过滤:"#ffb347",个人化:"#c06c84",控制谬误:"#7579e7",贴标签:"#84b1ed",读心术:"#d183c9"};return e[t]||"#6c757d"},selectBias(t){this.selectedBias===t?this.selectedBias=null:this.selectedBias=t},getRecordStatus(t){return t.alternativeThought?"已完成分析":t.analysisResult&&t.analysisResult.cognitiveBiases?"分析进行中":"待分析"},getRecordStatusClass(t){return t.alternativeThought?"status-completed":t.analysisResult&&t.analysisResult.cognitiveBiases?"status-progress":"status-pending"},deleteRecord(t){confirm("确定要删除这条记录吗？删除后无法恢复。")&&(this.$store.state.thoughtRecords.splice(t,1),this.$store.saveState(),this.selectedRecordIndex===t?(this.selectedRecordIndex=0,this.loadSelectedRecord()):this.selectedRecordIndex>t&&this.selectedRecordIndex--)},async analyzeThought(){this.isLoading=!0,this.loadingProgress=0,this.loadingStage="初始化分析",this.apiError=null,this.loadingTip=this.getRandomTip();try{this.loadingStage="识别认知偏差",this.loadingProgress=25,this.loadingTip=this.getRandomTip();const t=await this.callLLM(this.getBiasPrompt());this.analysisResult.cognitiveBiases=this.parseBiasResponse(t),this.analyzedOnce=!0,this.loadingStage="生成引导问题",this.loadingProgress=50,this.loadingTip=this.getRandomTip();const e=await this.callLLM(this.getQuestionPrompt());this.analysisResult.guidingQuestions=this.parseQuestionResponse(e),this.$store.state.thoughtRecords[this.selectedRecordIndex].userResponse=this.userResponse,this.$store.state.thoughtRecords[this.selectedRecordIndex].analysisResult=this.analysisResult,this.$store.saveState(),this.loadingStage="生成替代想法",this.loadingProgress=75,this.loadingTip=this.getRandomTip(),await this.generateAlternativeThought()}catch(t){console.error("分析失败:",t),this.apiError=t.message||"分析过程中发生未知错误，请重试"}finally{this.loadingProgress=100,this.loadingStage="分析完成",this.loadingTip=null,setTimeout((()=>{this.isLoading=!1}),500)}},async generateAlternativeThought(){this.isLoading||(this.isLoading=!0,this.loadingProgress=0,this.loadingStage="生成替代想法");try{this.loadingProgress=50;const t=await this.callLLM(this.getAlternativeThoughtPrompt());this.alternativeThought=t.choices[0].message.content,this.loadingProgress=100}catch(t){console.error("生成替代想法失败:",t)}finally{setTimeout((()=>{this.isLoading=!1}),500)}},async callLLM(t){try{const e={"Content-Type":"application/json"},s="/api/llm-proxy",o={prompt:t};console.log(`正在调用代理服务: ${s}`);const a=await ge.A.post(s,o,{headers:e,timeout:45e3});return a.data}catch(e){if(console.error("调用代理服务失败:",e),e.response){console.error("代理服务响应:",e.response.data);const t=e.response.data?.error||(e.response.data?.details?`代理错误: ${e.response.data.details}`:`代理服务返回错误: ${e.response.status}`);throw new Error(t)}throw e.request?new Error("未收到代理服务响应，请检查网络连接或稍后重试"):new Error(`请求配置错误: ${e.message}`)}},getBiasPrompt(){let t="请作为一名专业的认知行为治疗师，仔细分析以下内容中可能存在的认知偏差。\n  \n认知偏差是人们在思考过程中出现的系统性错误或模式，往往导致非理性判断和决策。";return this.currentRecord.situation&&(t+=`\n\n情境描述：${this.currentRecord.situation}`),t+=`\n\n自动思维："${this.currentRecord.automaticThought}"`,this.currentRecord.emotions&&this.currentRecord.emotions.length>0&&(t+=`\n\n伴随情绪：${this.currentRecord.emotions.join("、")}（强度：${this.currentRecord.intensity}%）`),t+='\n\n请识别出上述内容中存在的认知偏差，并严格按照以下JSON格式返回（不要有任何额外文字）：\n{\n  "biases": [\n    {\n      "type": "偏差类型名称",\n      "confidence": 置信度百分比（例如85，不要带%符号）,\n      "evidence": "详细说明为什么这属于该种偏差的文本依据"\n    }\n  ]\n}\n\n常见的认知偏差类型包括：\n1. 灾难化：过分夸大负面事件的后果\n2. 非黑即白：将事物简化为两个极端类别\n3. 过度概括：从单一事件中得出普遍结论\n4. 情绪推理：根据情绪状态而非客观事实做判断\n5. 应该陈述：用刚性的规则要求自己或他人\n6. 心理过滤：只关注负面细节而忽视积极方面\n7. 个人化：不合理地将外部事件归因于自己\n8. 控制谬误：认为应当能控制所有事情\n9. 贴标签：用简单标签概括复杂情况\n10. 读心术：假设知道他人的想法或感受\n\n如果没有发现明显的认知偏差，请返回空数组：{"biases": []}',t},getQuestionPrompt(){let t="作为一名专业的认知行为治疗师，请针对以下内容设计3个有效的苏格拉底式引导问题，帮助当事人质疑和挑战自己的思维模式。";return this.currentRecord.situation&&(t+=`\n\n情境描述：${this.currentRecord.situation}`),t+=`\n\n自动思维："${this.currentRecord.automaticThought}"`,this.currentRecord.emotions&&this.currentRecord.emotions.length>0&&(t+=`\n\n伴随情绪：${this.currentRecord.emotions.join("、")}`),this.analysisResult.cognitiveBiases&&this.analysisResult.cognitiveBiases.length>0&&(t+=`\n\n识别到的认知偏差：${this.analysisResult.cognitiveBiases.map((t=>t.type)).join("、")}`),t+='\n\n请设计3个开放式的苏格拉底式问题，这些问题应该：\n1. 鼓励深度思考而非简单的是/否回答\n2. 帮助挑战非理性信念\n3. 引导探索替代性解释\n4. 使用温和而尊重的语气\n5. 针对当事人的具体情况而非泛泛而谈\n\n请只返回问题本身的JSON数组格式（不要有任何额外说明）：\n["问题1", "问题2", "问题3"]',t},getAlternativeThoughtPrompt(){let t="作为一名认知行为治疗师，请根据以下信息，生成一个更加平衡、理性的替代思维。";return this.currentRecord.situation&&(t+=`\n\n情境描述：${this.currentRecord.situation}`),t+=`\n\n原始自动思维："${this.currentRecord.automaticThought}"`,this.currentRecord.emotions&&this.currentRecord.emotions.length>0&&(t+=`\n\n伴随情绪：${this.currentRecord.emotions.join("、")}`),this.analysisResult.cognitiveBiases&&this.analysisResult.cognitiveBiases.length>0&&(t+=`\n\n识别到的认知偏差：${this.analysisResult.cognitiveBiases.map((t=>t.type)).join("、")}`),t+=`\n\n用户对引导问题的思考：${this.userResponse||"(用户尚未填写)"}`,t+="\n\n请生成一个更加平衡和理性的替代思维，应该：\n1. 用第一人称表达，就像当事人自己在说话\n2. 使用口语化、自然的中文表达\n3. 保持温暖、支持和鼓励的语气\n4. 承认事实，但提供更加平衡和有建设性的视角\n5. 长度适中，通常为2-4句话\n\n请直接返回替代思维内容，不要包含任何额外的解释或说明。",t},parseBiasResponse(t){try{const o=t.choices[0].message.content;try{const t=JSON.parse(o);if(t&&t.biases)return t.biases}catch(e){console.error("解析偏差JSON失败:",e);const t=o.match(/\{[\s\S]*\}/);if(t)try{const e=JSON.parse(t[0]);if(e&&e.biases)return e.biases}catch(s){console.error("提取JSON后解析仍然失败:",s)}}return console.warn("无法从LLM响应中解析出认知偏差数据，原始响应:",o),[]}catch(o){return console.error("解析偏差响应失败:",o),[]}},parseQuestionResponse(t){try{const o=t.choices[0].message.content;try{const t=JSON.parse(o);if(Array.isArray(t))return t}catch(e){console.error("解析问题JSON失败:",e);const t=o.match(/\[[\s\S]*\]/);if(t)try{const e=JSON.parse(t[0]);if(Array.isArray(e))return e}catch(s){console.error("提取数组后解析仍然失败:",s)}}if(o.includes("\n")){const t=o.split("\n").filter((t=>t.trim()&&!t.startsWith("[")&&!t.startsWith("]")&&!t.startsWith("```")));if(t.length>0)return t.map((t=>t.replace(/^[0-9]+[\.\)]\s*/,"").trim())).filter((t=>t))}return console.warn("无法从LLM响应中解析出问题数据，原始响应:",o),[]}catch(o){return console.error("解析问题响应失败:",o),[]}},saveAlternativeThought(){this.$store.state.thoughtRecords[this.selectedRecordIndex].alternativeThought=this.alternativeThought,this.$store.state.thoughtRecords[this.selectedRecordIndex].userResponse=this.userResponse,this.$store.saveState(),alert("替代想法已保存！")},getRandomTip(){return this.loadingTips[Math.floor(Math.random()*this.loadingTips.length)]}}},me=(0,b.A)(pe,[["render",he],["__scopeId","data-v-d1a01a10"]]),ke=me,ve={class:"dashboard"},ye={class:"welcome-header"},Le={key:0,class:"last-record"},be={class:"dashboard-grid stats-section"},Re={class:"stat-card total-records"},Ce={class:"stat-content"},fe={class:"stat-number"},Ee={class:"stat-card analyzed-records"},Te={class:"stat-content"},xe={class:"stat-number"},_e={class:"stat-card mood-trend"},Se={class:"stat-content"},we={class:"dashboard-grid actions-section"},Xe={class:"action-content"},$e={key:0,class:"action-desc"},Be={key:1,class:"action-desc"},Ie={key:0,class:"recent-records"},Me={class:"dashboard-grid records-section"},Oe=["onClick"],Fe={class:"record-header"},Qe={class:"record-date"},Ae={class:"record-emotions"},We={key:0,class:"emotion-more"},Pe={class:"record-thought"},je={class:"dashboard-grid charts-section"},Ne={class:"chart-card emotion-stats"},Je={class:"chart-card-header"},Ke={key:0,class:"stat-card-actions"},De={class:"emotion-count-badge"},Ve={key:0,class:"chart-content emotion-chart"},ze={class:"chart-label"},Ue={class:"emotion-emoji"},He={class:"emotion-name"},qe={class:"chart-bar-container"},Ye={class:"chart-value"},Ge={key:1,class:"no-data"},Ze={class:"chart-card bias-stats"},ts={class:"chart-card-header"},es={key:0,class:"stat-card-actions"},ss={class:"bias-count-badge"},os={key:0,class:"chart-content bias-chart"},as={class:"chart-label"},ns={class:"bias-name"},is={class:"chart-bar-container"},ls={class:"chart-value"},rs={key:1,class:"no-data"};function cs(t,e,s,o,a,n){const i=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",ve,[(0,l.Lk)("header",ye,[e[0]||(e[0]=(0,l.Lk)("h1",null,"👋 欢迎回来，心理健康伙伴！",-1)),n.latestRecord?((0,l.uX)(),(0,l.CE)("p",Le," 上次记录："+(0,c.v_)(n.formatDate(n.latestRecord.timestamp)),1)):(0,l.Q3)("",!0)]),(0,l.Lk)("section",be,[(0,l.Lk)("div",Re,[e[2]||(e[2]=(0,l.Lk)("div",{class:"stat-icon"},"📊",-1)),(0,l.Lk)("div",Ce,[e[1]||(e[1]=(0,l.Lk)("h4",null,"已记录思想",-1)),(0,l.Lk)("div",fe,(0,c.v_)(t.$store.state.thoughtRecords.length),1)])]),(0,l.Lk)("div",Ee,[e[4]||(e[4]=(0,l.Lk)("div",{class:"stat-icon"},"🧠",-1)),(0,l.Lk)("div",Te,[e[3]||(e[3]=(0,l.Lk)("h4",null,"完成分析",-1)),(0,l.Lk)("div",xe,(0,c.v_)(n.analyzedRecordsCount),1)])]),(0,l.Lk)("div",_e,[e[6]||(e[6]=(0,l.Lk)("div",{class:"stat-icon"},"😊",-1)),(0,l.Lk)("div",Se,[e[5]||(e[5]=(0,l.Lk)("h4",null,"情绪趋势",-1)),(0,l.Lk)("div",{class:(0,c.C4)(["trend-indicator",n.moodTrend.class])},(0,c.v_)(n.moodTrend.label),3)])])]),(0,l.Lk)("section",we,[(0,l.bF)(i,{to:"/record",class:"action-card new-record"},{default:(0,l.k6)((()=>e[7]||(e[7]=[(0,l.Lk)("div",{class:"action-content"},[(0,l.Lk)("span",{class:"icon"},"📝"),(0,l.Lk)("h3",null,"新建记录"),(0,l.Lk)("p",{class:"action-desc"},"记录你的自动思维和情绪体验")],-1)]))),_:1}),(0,l.bF)(i,{to:"/analysis",class:(0,c.C4)(["action-card view-analysis",{disabled:!n.hasRecords}])},{default:(0,l.k6)((()=>[(0,l.Lk)("div",Xe,[e[8]||(e[8]=(0,l.Lk)("span",{class:"icon"},"🔍",-1)),e[9]||(e[9]=(0,l.Lk)("h3",null,"查看分析",-1)),n.hasRecords?((0,l.uX)(),(0,l.CE)("p",$e,(0,c.v_)(n.analysisSummary),1)):((0,l.uX)(),(0,l.CE)("p",Be,"请先记录你的想法"))])])),_:1},8,["class"])]),n.hasRecords?((0,l.uX)(),(0,l.CE)("section",Ie,[e[10]||(e[10]=(0,l.Lk)("h2",{class:"section-title"},"🕒 最近记录",-1)),(0,l.Lk)("div",Me,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.recentRecords,((t,e)=>((0,l.uX)(),(0,l.CE)("div",{key:e,class:"record-card",onClick:t=>n.goToAnalysis(e)},[(0,l.Lk)("div",Fe,[(0,l.Lk)("div",Qe,(0,c.v_)(n.formatDate(t.timestamp)),1),(0,l.Lk)("div",Ae,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(t.emotions.slice(0,2),((t,e)=>((0,l.uX)(),(0,l.CE)("span",{key:e,class:"emotion-tag"},(0,c.v_)(t),1)))),128)),t.emotions.length>2?((0,l.uX)(),(0,l.CE)("span",We,"+"+(0,c.v_)(t.emotions.length-2),1)):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",Pe,(0,c.v_)(n.truncateText(t.automaticThought,80)),1),(0,l.Lk)("div",{class:(0,c.C4)(["record-status",n.getRecordStatusClass(t)])},(0,c.v_)(n.getRecordStatus(t)),3)],8,Oe)))),128))])])):(0,l.Q3)("",!0),(0,l.Lk)("section",je,[(0,l.Lk)("div",Ne,[(0,l.Lk)("div",Je,[e[11]||(e[11]=(0,l.Lk)("h5",null,[(0,l.Lk)("span",{class:"stat-icon-small"},"📊"),(0,l.eW)(" 情绪分布")],-1)),n.hasRecords?((0,l.uX)(),(0,l.CE)("div",Ke,[(0,l.Lk)("div",De,(0,c.v_)(Object.keys(n.emotionDistribution).length)+"种情绪",1)])):(0,l.Q3)("",!0)]),Object.keys(n.emotionDistribution).length>0?((0,l.uX)(),(0,l.CE)("div",Ve,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.sortedEmotions,((t,e)=>((0,l.uX)(),(0,l.CE)("div",{key:e,class:"chart-item"},[(0,l.Lk)("div",ze,[(0,l.Lk)("span",Ue,(0,c.v_)(n.getEmotionEmoji(e)),1),(0,l.Lk)("span",He,(0,c.v_)(e),1)]),(0,l.Lk)("div",qe,[(0,l.Lk)("div",{class:"chart-bar",style:(0,c.Tr)({width:t/n.maxEmotionCount*100+"%"})},null,4),(0,l.Lk)("span",Ye,(0,c.v_)(t),1)])])))),128))])):((0,l.uX)(),(0,l.CE)("div",Ge," 暂无情绪数据，请记录你的情绪体验 "))]),(0,l.Lk)("div",Ze,[(0,l.Lk)("div",ts,[e[12]||(e[12]=(0,l.Lk)("h5",null,[(0,l.Lk)("span",{class:"stat-icon-small"},"⚠️"),(0,l.eW)(" 常见认知偏差")],-1)),n.topBiases.length>0?((0,l.uX)(),(0,l.CE)("div",es,[(0,l.Lk)("div",ss,"共"+(0,c.v_)(n.getBiasesTotal())+"次",1)])):(0,l.Q3)("",!0)]),n.topBiases.length>0?((0,l.uX)(),(0,l.CE)("div",os,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.topBiases,((t,e)=>((0,l.uX)(),(0,l.CE)("div",{key:e,class:"chart-item"},[(0,l.Lk)("div",as,[(0,l.Lk)("span",{class:"bias-icon",style:(0,c.Tr)({backgroundColor:n.getBiasColor(t.type)})},null,4),(0,l.Lk)("span",ns,(0,c.v_)(t.type),1)]),(0,l.Lk)("div",is,[(0,l.Lk)("div",{class:"chart-bar bias-bar",style:(0,c.Tr)({width:t.count/n.maxBiasCount*100+"%",background:`linear-gradient(to right, ${n.getBiasColorLight(t.type)}, ${n.getBiasColor(t.type)})`})},null,4),(0,l.Lk)("span",ls,(0,c.v_)(t.count),1)])])))),128))])):((0,l.uX)(),(0,l.CE)("div",rs," 暂无认知偏差数据，请完成分析 "))])])])}const ds={computed:{latestRecord(){return this.$store.state.thoughtRecords[0]},hasRecords(){return this.$store.state.thoughtRecords.length>0},analysisSummary(){const t=this.$store.state.thoughtRecords.length;return t?`已有${t}条记录`:"暂无记录"},recentRecords(){return this.$store.state.thoughtRecords.slice(0,3)},emotionDistribution(){const t=this.$store.state.thoughtRecords.flatMap((t=>t.emotions||[]));return t.reduce(((t,e)=>(t[e]=(t[e]||0)+1,t)),{})},maxEmotionCount(){return Math.max(...Object.values(this.emotionDistribution||{}),1)},topBiases(){const t=this.$store.state.thoughtRecords.flatMap((t=>(t.analysisResult||{}).cognitiveBiases||[])).map((t=>t.type));return Object.entries(t.reduce(((t,e)=>(t[e]=(t[e]||0)+1,t)),{})).sort(((t,e)=>e[1]-t[1])).slice(0,5).map((([t,e])=>({type:t,count:e})))},maxBiasCount(){return this.topBiases.length>0?Math.max(...this.topBiases.map((t=>t.count)),1):1},analyzedRecordsCount(){return this.$store.state.thoughtRecords.filter((t=>t.alternativeThought)).length},moodTrend(){const t=this.$store.state.thoughtRecords.slice(0,5);if(t.length<2)return{label:"数据不足",class:"neutral"};const e=t.slice(0,Math.ceil(t.length/2)).reduce(((t,e)=>t+(e.intensity||50)),0)/Math.ceil(t.length/2),s=t.slice(Math.ceil(t.length/2)).reduce(((t,e)=>t+(e.intensity||50)),0)/Math.floor(t.length/2),o=e-s;return o<-5?{label:"向好发展",class:"positive"}:o>5?{label:"略有波动",class:"negative"}:{label:"保持稳定",class:"neutral"}},sortedEmotions(){return Object.entries(this.emotionDistribution).sort(((t,e)=>e[1]-t[1])).reduce(((t,[e,s])=>(t[e]=s,t)),{})}},methods:{formatDate(t){return t?new Date(t).toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"未知时间"},truncateText(t,e){return t?t.length>e?t.slice(0,e)+"...":t:""},getRecordStatus(t){return t.alternativeThought?"已完成分析":t.analysisResult&&(t.analysisResult.cognitiveBiases&&t.analysisResult.cognitiveBiases.length>0||t.analysisResult.guidingQuestions&&t.analysisResult.guidingQuestions.length>0)?"分析进行中":"待分析"},getRecordStatusClass(t){return t.alternativeThought?"status-completed":t.analysisResult&&(t.analysisResult.cognitiveBiases&&t.analysisResult.cognitiveBiases.length>0||t.analysisResult.guidingQuestions&&t.analysisResult.guidingQuestions.length>0)?"status-progress":"status-pending"},goToAnalysis(t){this.$router.push("/analysis"),this.$store.selectedRecordIndex=t},getEmotionEmoji(t){const e={焦虑:"😰",沮丧:"😔",愤怒:"😠",悲伤:"😢",羞愧:"😳",兴奋:"😃",平静:"😌",恐惧:"😨",失落:"😞",担忧:"😟",自责:"😓",困惑:"🤔",无助:"🥺"};return e[t]||"😶"},getBiasColor(t){const e={灾难化:"#ff6b6b",非黑即白:"#4ecdc4",过度概括:"#45b7d1",情绪推理:"#96ceb4",应该陈述:"#ffeead",心理过滤:"#ffb347",个人化:"#c06c84",控制谬误:"#7579e7",贴标签:"#84b1ed",读心术:"#d183c9"};return e[t]||"#6c757d"},getBiasColorLight(t){const e=this.getBiasColor(t);return e.replace(")",", 0.3)").replace("rgb","rgba")},getBiasesTotal(){return this.topBiases.reduce(((t,e)=>t+e.count),0)}}},us=(0,b.A)(ds,[["render",cs],["__scopeId","data-v-642cd6b8"]]),hs=us,gs=(0,a.aE)({history:(0,a.LA)(),routes:[{path:"/",component:hs},{path:"/config",component:M},{path:"/record",component:mt},{path:"/analysis",component:ke}]}),ps={state:{apiConfig:{endpoint:"https://api.openai.com/v1/chat/completions",apiKey:"",model:"gpt-3.5-turbo"},thoughtRecords:[],selectedRecordIndex:void 0},saveState(){localStorage.setItem("cbtHelperState",JSON.stringify(this.state))},restoreState(){const t=localStorage.getItem("cbtHelperState");if(t)try{const e=JSON.parse(t);this.state={...this.state,...e,apiConfig:{...this.state.apiConfig,...e.apiConfig}}}catch(e){console.error("恢复状态失败:",e)}},clearAll(){this.state.thoughtRecords=[],this.saveState()}};ps.restoreState(),(0,n.WQ)();const ms=(0,o.Ef)(C);ms.use(gs),ms.config.globalProperties.$store=ps,ms.component("SpeedInsights",i.b),ms.mount("#app")}},e={};function s(o){var a=e[o];if(void 0!==a)return a.exports;var n=e[o]={exports:{}};return t[o](n,n.exports,s),n.exports}s.m=t,(()=>{var t=[];s.O=(e,o,a,n)=>{if(!o){var i=1/0;for(d=0;d<t.length;d++){for(var[o,a,n]=t[d],l=!0,r=0;r<o.length;r++)(!1&n||i>=n)&&Object.keys(s.O).every((t=>s.O[t](o[r])))?o.splice(r--,1):(l=!1,n<i&&(i=n));if(l){t.splice(d--,1);var c=a();void 0!==c&&(e=c)}}return e}n=n||0;for(var d=t.length;d>0&&t[d-1][2]>n;d--)t[d]=t[d-1];t[d]=[o,a,n]}})(),(()=>{s.d=(t,e)=>{for(var o in e)s.o(e,o)&&!s.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}})(),(()=>{s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()})(),(()=>{s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e)})(),(()=>{s.r=t=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}})(),(()=>{s.p="/"})(),(()=>{var t={524:0};s.O.j=e=>0===t[e];var e=(e,o)=>{var a,n,[i,l,r]=o,c=0;if(i.some((e=>0!==t[e]))){for(a in l)s.o(l,a)&&(s.m[a]=l[a]);if(r)var d=r(s)}for(e&&e(o);c<i.length;c++)n=i[c],s.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return s.O(d)},o=self["webpackChunkcbthelper"]=self["webpackChunkcbthelper"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))})();var o=s.O(void 0,[504],(()=>s(367)));o=s.O(o)})();
//# sourceMappingURL=app.8993db6d.js.map