(()=>{"use strict";var e={522:(e,t,s)=>{var o=s(751),a=s(220),n=s(60);const i=JSON.parse('{"nav":{"home":"首页","record":"记录想法","analysis":"认知分析","config":"设置"},"footer":{"copy":"&copy; {year} CBT Helper. All rights reserved.","disclaimer":"本工具仅供信息参考和自我辅助，不能替代专业的心理咨询或治疗。如有严重心理困扰，请寻求专业帮助。"},"dashboard":{"welcome":"👋 欢迎回来，心理健康伙伴！","lastRecordPrefix":"上次记录：","statTotalRecords":"已记录思想","statAnalyzedRecords":"完成分析","statMoodTrend":"情绪趋势","trendInsufficientData":"数据不足","trendImproving":"向好发展","trendFluctuating":"略有波动","trendStable":"保持稳定","actionNewRecord":"新建记录","actionNewRecordDesc":"记录你的自动思维和情绪体验","actionViewAnalysis":"查看分析","analysisSummary":"已有{count}条记录","analysisSummaryEmpty":"暂无记录","analysisPrompt":"请先记录你的想法","recentRecordsTitle":"🕒 最近记录","statusCompleted":"已完成分析","statusInProgress":"分析进行中","statusPending":"待分析","chartEmotionTitle":"情绪分布","chartEmotionCount":"{count}种情绪","chartEmotionEmpty":"暂无情绪数据，请记录你的情绪体验","chartBiasTitle":"常见认知偏差","chartBiasCount":"共{count}次","chartBiasEmpty":"暂无认知偏差数据，请完成分析","unknownTime":"未知时间"},"common":{"emotions":{"anxiety":"焦虑","depression":"沮丧","anger":"愤怒","sadness":"悲伤","shame":"羞愧","excitement":"兴奋","calm":"平静","fear":"恐惧","loss":"失落","worry":"担忧","selfBlame":"自责","confusion":"困惑","helplessness":"无助"},"biases":{"catastrophizing":"灾难化","allOrNothing":"非黑即白","overgeneralization":"过度概括","emotionalReasoning":"情绪推理","shouldStatements":"应该陈述","mentalFilter":"心理过滤","personalization":"个人化","controlFallacy":"控制谬误","labeling":"贴标签","mindReading":"读心术"}}}'),l=JSON.parse('{"nav":{"home":"首頁","record":"記錄想法","analysis":"認知分析","config":"設定"},"footer":{"copy":"&copy; {year} CBT Helper. All rights reserved.","disclaimer":"本工具僅供資訊參考和自我輔助，不能替代專業的心理諮詢或治療。如有嚴重心理困擾，請尋求專業協助。"},"dashboard":{"welcome":"👋 歡迎回來，心理健康夥伴！","lastRecordPrefix":"上次記錄：","statTotalRecords":"已記錄思想","statAnalyzedRecords":"完成分析","statMoodTrend":"情緒趨勢","trendInsufficientData":"資料不足","trendImproving":"向好發展","trendFluctuating":"略有波動","trendStable":"保持穩定","actionNewRecord":"新建記錄","actionNewRecordDesc":"記錄你的自動思維和情緒體驗","actionViewAnalysis":"查看分析","analysisSummary":"已有{count}條記錄","analysisSummaryEmpty":"暫無記錄","analysisPrompt":"請先記錄你的想法","recentRecordsTitle":"🕒 最近記錄","statusCompleted":"已完成分析","statusInProgress":"分析進行中","statusPending":"待分析","chartEmotionTitle":"情緒分佈","chartEmotionCount":"{count}種情緒","chartEmotionEmpty":"暫無情緒資料，請記錄你的情緒體驗","chartBiasTitle":"常見認知偏差","chartBiasCount":"共{count}次","chartBiasEmpty":"暫無認知偏差資料，請完成分析","unknownTime":"未知時間"},"common":{"emotions":{"anxiety":"焦慮","depression":"沮喪","anger":"憤怒","sadness":"悲傷","shame":"羞愧","excitement":"興奮","calm":"平靜","fear":"恐懼","loss":"失落","worry":"擔憂","selfBlame":"自責","confusion":"困惑","helplessness":"無助"},"biases":{"catastrophizing":"災難化","allOrNothing":"非黑即白","overgeneralization":"過度概括","emotionalReasoning":"情緒推理","shouldStatements":"應該陳述","mentalFilter":"心理過濾","personalization":"個人化","controlFallacy":"控制謬誤","labeling":"貼標籤","mindReading":"讀心術"}}}');var r=s(641),c=s(33),d=s(953);const u={id:"app",class:"app-container"},h={class:"app-header"},m={class:"header-content"},g={class:"logo"},p={class:"nav-links-desktop"},v={class:"header-right"},k={class:"app-content"},y={class:"app-footer"},b=["innerHTML"],L={class:"disclaimer"},R={__name:"App",setup(e){const t=(0,r.WQ)("store"),{t:s,locale:a}=(0,n.s9)(),i=(0,d.KR)(!1),l=(0,r.EW)((()=>t.state.currentLocale));function R(){i.value=!i.value}function f(){i.value=!1}function C(){const e="sc"===l.value?"tc":"sc";t.setLocale(e)}return(e,t)=>{const a=(0,r.g2)("router-link"),n=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.CE)("div",u,[(0,r.Lk)("header",h,[(0,r.Lk)("div",m,[(0,r.Lk)("div",g,[(0,r.bF)(a,{to:"/"},{default:(0,r.k6)((()=>t[0]||(t[0]=[(0,r.eW)("CBT Helper")]))),_:1})]),(0,r.Lk)("nav",p,[(0,r.bF)(a,{to:"/",class:"nav-link","active-class":"router-link-active"},{default:(0,r.k6)((()=>[(0,r.eW)((0,c.v_)((0,d.R1)(s)("nav.home")),1)])),_:1}),(0,r.bF)(a,{to:"/record",class:"nav-link","active-class":"router-link-active"},{default:(0,r.k6)((()=>[(0,r.eW)((0,c.v_)((0,d.R1)(s)("nav.record")),1)])),_:1}),(0,r.bF)(a,{to:"/analysis",class:"nav-link","active-class":"router-link-active"},{default:(0,r.k6)((()=>[(0,r.eW)((0,c.v_)((0,d.R1)(s)("nav.analysis")),1)])),_:1}),(0,r.bF)(a,{to:"/config",class:"nav-link","active-class":"router-link-active"},{default:(0,r.k6)((()=>[(0,r.eW)((0,c.v_)((0,d.R1)(s)("nav.config")),1)])),_:1})]),(0,r.Lk)("div",v,[(0,r.Lk)("button",{class:"locale-switcher",onClick:C},(0,c.v_)("sc"===l.value?"繁":"简"),1),(0,r.Lk)("button",{class:(0,c.C4)(["nav-toggle-mobile",{"is-active":i.value}]),onClick:R,"aria-label":"Toggle navigation","aria-expanded":"isMobileMenuOpen"},t[1]||(t[1]=[(0,r.Lk)("span",{class:"icon-bar"},null,-1),(0,r.Lk)("span",{class:"icon-bar"},null,-1),(0,r.Lk)("span",{class:"icon-bar"},null,-1)]),2)])]),(0,r.Lk)("nav",{class:(0,c.C4)(["nav-links-mobile",{"is-active":i.value}])},[(0,r.bF)(a,{to:"/",class:"nav-link","active-class":"router-link-active",onClick:f},{default:(0,r.k6)((()=>[(0,r.eW)((0,c.v_)((0,d.R1)(s)("nav.home")),1)])),_:1}),(0,r.bF)(a,{to:"/record",class:"nav-link","active-class":"router-link-active",onClick:f},{default:(0,r.k6)((()=>[(0,r.eW)((0,c.v_)((0,d.R1)(s)("nav.record")),1)])),_:1}),(0,r.bF)(a,{to:"/analysis",class:"nav-link","active-class":"router-link-active",onClick:f},{default:(0,r.k6)((()=>[(0,r.eW)((0,c.v_)((0,d.R1)(s)("nav.analysis")),1)])),_:1}),(0,r.bF)(a,{to:"/config",class:"nav-link","active-class":"router-link-active",onClick:f},{default:(0,r.k6)((()=>[(0,r.eW)((0,c.v_)((0,d.R1)(s)("nav.config")),1)])),_:1})],2)]),(0,r.Lk)("main",k,[(0,r.bF)(n,null,{default:(0,r.k6)((({Component:e})=>[(0,r.bF)(o.eB,{name:"fade",mode:"out-in"},{default:(0,r.k6)((()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e)))])),_:2},1024)])),_:1})]),(0,r.Lk)("footer",y,[(0,r.Lk)("p",{innerHTML:(0,d.R1)(s)("footer.copy",{year:(new Date).getFullYear()})},null,8,b),(0,r.Lk)("p",L,(0,c.v_)((0,d.R1)(s)("footer.disclaimer")),1)])])}}};var f=s(262);const C=(0,f.A)(R,[["__scopeId","data-v-1a3721b0"]]),E=C,T={class:"config-container"},_={class:"card"},w={class:"form-group"},x={class:"form-group"},S={class:"form-group"},X={key:0,class:"form-group"},I=["disabled"],$={key:1,class:"alert alert-success mt-3"};function M(e,t,s,a,n,i){return(0,r.uX)(),(0,r.CE)("div",T,[t[11]||(t[11]=(0,r.Lk)("h2",{class:"mb-4"},"🔧 API 设置",-1)),(0,r.Lk)("div",_,[(0,r.Lk)("div",w,[t[6]||(t[6]=(0,r.Lk)("label",null,"API 端点",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=e=>n.apiConfig.endpoint=e),placeholder:"https://api.openai.com/v1/chat/completions"},null,512),[[o.Jo,n.apiConfig.endpoint]])]),(0,r.Lk)("div",x,[t[7]||(t[7]=(0,r.Lk)("label",null,"API 密钥",-1)),(0,r.bo)((0,r.Lk)("input",{type:"password",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=e=>n.apiConfig.apiKey=e),placeholder:"sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"},null,512),[[o.Jo,n.apiConfig.apiKey]])]),(0,r.Lk)("div",S,[t[9]||(t[9]=(0,r.Lk)("label",null,"模型选择",-1)),(0,r.bo)((0,r.Lk)("select",{class:"form-control","onUpdate:modelValue":t[2]||(t[2]=e=>n.selectedModelOption=e),onChange:t[3]||(t[3]=(...e)=>i.handleModelChange&&i.handleModelChange(...e))},t[8]||(t[8]=[(0,r.Lk)("option",{value:"gpt-3.5-turbo"},"gpt-3.5-turbo",-1),(0,r.Lk)("option",{value:"gpt-4"},"gpt-4",-1),(0,r.Lk)("option",{value:"gpt-4-turbo"},"gpt-4-turbo",-1),(0,r.Lk)("option",{value:"custom"},"自定义...",-1)]),544),[[o.u1,n.selectedModelOption]])]),"custom"===n.selectedModelOption?((0,r.uX)(),(0,r.CE)("div",X,[t[10]||(t[10]=(0,r.Lk)("label",null,"自定义模型名称",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[4]||(t[4]=e=>n.customModelName=e),placeholder:"输入自定义模型名称"},null,512),[[o.Jo,n.customModelName]])])):(0,r.Q3)("",!0),(0,r.Lk)("button",{class:"btn btn-primary",onClick:t[5]||(t[5]=(...e)=>i.saveConfig&&i.saveConfig(...e)),disabled:!i.isFormValid}," 💾 保存设置 ",8,I),n.showSuccess?((0,r.uX)(),(0,r.CE)("div",$," ✅ 设置保存成功！ ")):(0,r.Q3)("",!0)])])}const O={data(){return{apiConfig:{...this.$store.state.apiConfig},showSuccess:!1,selectedModelOption:"",customModelName:""}},created(){const e=["gpt-3.5-turbo","gpt-4","gpt-4-turbo"];e.includes(this.apiConfig.model)?this.selectedModelOption=this.apiConfig.model:(this.selectedModelOption="custom",this.customModelName=this.apiConfig.model)},computed:{isFormValid(){const e=this.apiConfig.endpoint&&this.apiConfig.apiKey;return"custom"===this.selectedModelOption?e&&this.customModelName:e&&this.selectedModelOption}},methods:{handleModelChange(){"custom"!==this.selectedModelOption?this.apiConfig.model=this.selectedModelOption:this.customModelName||(this.customModelName=this.apiConfig.model)},saveConfig(){"custom"===this.selectedModelOption&&(this.apiConfig.model=this.customModelName),this.$store.state.apiConfig=this.apiConfig,this.$store.saveState(),this.showSuccess=!0,setTimeout((()=>this.showSuccess=!1),2e3)}}},B=(0,f.A)(O,[["render",M],["__scopeId","data-v-6c594775"]]),F=B,W={class:"record-container"},Q={class:"card thought-form"},P={class:"form-group"},A={class:"input-icon-wrapper"},N={class:"form-group"},j={class:"input-icon-wrapper"},z={class:"form-group"},J={class:"emotion-tags"},K=["onClick"],D={class:"custom-emotion"},V={class:"emotion-tag-input-container"},H={key:0,class:"selected-emotions"},U=["onClick"],q={class:"form-group"},Y={class:"form-label"},G={class:"intensity-value"},Z={class:"intensity-slider"},ee={class:"form-actions"},te=["disabled"],se={key:0,class:"alert alert-success mt-3 fade-transition"},oe={key:0,class:"recent-thoughts"},ae={class:"thoughts-list"},ne=["onClick"],ie={class:"thought-card-header"},le={class:"thought-date"},re={class:"thought-emotions"},ce={key:0,class:"emotion-more"},de={class:"thought-content"},ue={class:"thought-card-footer"},he={class:"thought-intensity"},me={class:"intensity-badge"};function ge(e,t,s,a,n,i){const l=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",W,[t[23]||(t[23]=(0,r.Lk)("h2",{class:"section-title"},"📝 记录你的想法",-1)),(0,r.Lk)("div",Q,[(0,r.Lk)("form",{onSubmit:t[6]||(t[6]=(0,o.D$)(((...e)=>i.saveRecord&&i.saveRecord(...e)),["prevent"]))},[(0,r.Lk)("div",P,[t[8]||(t[8]=(0,r.Lk)("label",{class:"form-label"},"情境描述",-1)),(0,r.Lk)("div",A,[t[7]||(t[7]=(0,r.Lk)("span",{class:"input-icon"},"🔍",-1)),(0,r.bo)((0,r.Lk)("textarea",{class:"form-control",rows:"3","onUpdate:modelValue":t[0]||(t[0]=e=>n.newRecord.situation=e),placeholder:"发生了什么？在哪里？什么时候？"},null,512),[[o.Jo,n.newRecord.situation]])])]),(0,r.Lk)("div",N,[t[10]||(t[10]=(0,r.Lk)("label",{class:"form-label"},[(0,r.eW)("自动思维 "),(0,r.Lk)("span",{class:"required"},"*")],-1)),(0,r.Lk)("div",j,[t[9]||(t[9]=(0,r.Lk)("span",{class:"input-icon"},"💭",-1)),(0,r.bo)((0,r.Lk)("textarea",{class:"form-control",rows:"3","onUpdate:modelValue":t[1]||(t[1]=e=>n.newRecord.automaticThought=e),placeholder:"你当时想到了什么？有什么样的想法闪过脑海？",required:""},null,512),[[o.Jo,n.newRecord.automaticThought]])])]),(0,r.Lk)("div",z,[t[11]||(t[11]=(0,r.Lk)("label",{class:"form-label"},"情绪体验",-1)),(0,r.Lk)("div",J,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.commonEmotions,(e=>((0,r.uX)(),(0,r.CE)("button",{type:"button",class:(0,c.C4)(["emotion-tag-btn",{active:n.newRecord.emotions.includes(e)}]),key:e,onClick:t=>i.toggleEmotion(e)},(0,c.v_)(i.getEmotionEmoji(e))+" "+(0,c.v_)(e),11,K)))),128))]),(0,r.Lk)("div",D,[(0,r.Lk)("div",V,[n.customEmotions.length>0?((0,r.uX)(),(0,r.CE)("div",H,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.customEmotions,((e,t)=>((0,r.uX)(),(0,r.CE)("span",{key:t,class:"custom-emotion-tag"},[(0,r.eW)((0,c.v_)(e)+" ",1),(0,r.Lk)("span",{class:"remove-emotion",onClick:e=>i.removeCustomEmotion(t)},"×",8,U)])))),128))])):(0,r.Q3)("",!0),(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control emotion-input","onUpdate:modelValue":t[2]||(t[2]=e=>n.currentEmotion=e),placeholder:"输入其他情绪并按Enter添加...",onKeydown:t[3]||(t[3]=(0,o.jR)((0,o.D$)(((...e)=>i.addCustomEmotion&&i.addCustomEmotion(...e)),["prevent"]),["enter"]))},null,544),[[o.Jo,n.currentEmotion]])])])]),(0,r.Lk)("div",q,[(0,r.Lk)("label",Y,[t[12]||(t[12]=(0,r.eW)("情绪强度 ")),(0,r.Lk)("span",G,(0,c.v_)(n.newRecord.intensity)+"%",1)]),(0,r.Lk)("div",Z,[t[13]||(t[13]=(0,r.Lk)("span",{class:"intensity-min"},"😌 轻微",-1)),(0,r.bo)((0,r.Lk)("input",{type:"range",class:"custom-range",min:"0",max:"100",step:"5","onUpdate:modelValue":t[4]||(t[4]=e=>n.newRecord.intensity=e)},null,512),[[o.Jo,n.newRecord.intensity,void 0,{number:!0}]]),t[14]||(t[14]=(0,r.Lk)("span",{class:"intensity-max"},"😫 强烈",-1))])]),(0,r.Lk)("div",ee,[(0,r.Lk)("button",{type:"submit",class:"btn btn-primary submit-btn",disabled:!i.isFormValid},t[15]||(t[15]=[(0,r.Lk)("span",{class:"btn-icon"},"💾",-1),(0,r.eW)(" 保存记录 ")]),8,te),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[5]||(t[5]=(...e)=>i.resetForm&&i.resetForm(...e))},t[16]||(t[16]=[(0,r.Lk)("span",{class:"btn-icon"},"🔄",-1),(0,r.eW)(" 重置 ")]))]),n.showSuccess?((0,r.uX)(),(0,r.CE)("div",se,[t[18]||(t[18]=(0,r.eW)(" ✅ 记录保存成功！快去")),(0,r.bF)(l,{to:"/analysis"},{default:(0,r.k6)((()=>t[17]||(t[17]=[(0,r.eW)("分析页面")]))),_:1}),t[19]||(t[19]=(0,r.eW)("看看吧 "))])):(0,r.Q3)("",!0)],32)]),e.$store.state.thoughtRecords.length>0?((0,r.uX)(),(0,r.CE)("div",oe,[t[22]||(t[22]=(0,r.Lk)("h3",{class:"subsection-title"},"最近记录",-1)),(0,r.Lk)("div",ae,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.recentThoughts,((e,s)=>((0,r.uX)(),(0,r.CE)("div",{class:"thought-card",key:s,onClick:e=>i.goToAnalysis(s)},[(0,r.Lk)("div",ie,[(0,r.Lk)("span",le,(0,c.v_)(i.formatDate(e.timestamp)),1),(0,r.Lk)("div",re,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.emotions.slice(0,2),((e,t)=>((0,r.uX)(),(0,r.CE)("span",{key:t,class:"emotion-badge"},(0,c.v_)(e),1)))),128)),e.emotions.length>2?((0,r.uX)(),(0,r.CE)("span",ce,"+"+(0,c.v_)(e.emotions.length-2),1)):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",de,(0,c.v_)(i.truncateText(e.automaticThought,100)),1),(0,r.Lk)("div",ue,[(0,r.Lk)("div",he,[t[20]||(t[20]=(0,r.eW)(" 强度: ")),(0,r.Lk)("span",me,(0,c.v_)(e.intensity)+"%",1)]),t[21]||(t[21]=(0,r.Lk)("span",{class:"view-analysis"},"查看分析 →",-1))])],8,ne)))),128))])])):(0,r.Q3)("",!0)])}const pe={data(){return{newRecord:{situation:"",automaticThought:"",emotions:[],customEmotion:"",intensity:50,timestamp:null},commonEmotions:["焦虑","沮丧","愤怒","悲伤","羞愧","兴奋","平静","恐惧","失落","担忧"],showSuccess:!1,currentEmotion:"",customEmotions:[]}},computed:{isFormValid(){return this.newRecord.automaticThought.trim()&&this.newRecord.intensity>0},recentThoughts(){return this.$store.state.thoughtRecords.slice(0,3)}},methods:{getEmotionEmoji(e){const t={焦虑:"😰",沮丧:"😔",愤怒:"😠",悲伤:"😢",羞愧:"😳",兴奋:"😃",平静:"😌",恐惧:"😨",失落:"😞",担忧:"😟"};return t[e]||"😶"},toggleEmotion(e){const t=this.newRecord.emotions.indexOf(e);-1===t?this.newRecord.emotions.push(e):this.newRecord.emotions.splice(t,1)},addCustomEmotion(){const e=this.currentEmotion.trim();e&&!this.customEmotions.includes(e)&&(this.customEmotions.push(e),this.currentEmotion="")},removeCustomEmotion(e){this.customEmotions.splice(e,1)},saveRecord(){const e={...this.newRecord,timestamp:(new Date).toISOString(),emotions:[...this.newRecord.emotions,...this.customEmotions]};this.$store.state.thoughtRecords.unshift(e),this.$store.saveState(),void 0!==this.$store.selectedRecordIndex&&(this.$store.selectedRecordIndex=0),this.showSuccess=!0,setTimeout((()=>{this.showSuccess=!1,this.resetForm()}),3e3)},resetForm(){this.newRecord={situation:"",automaticThought:"",emotions:[],customEmotion:"",intensity:50,timestamp:null},this.currentEmotion="",this.customEmotions=[]},formatDate(e){return e?new Date(e).toLocaleString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"未知时间"},truncateText(e,t){return e?e.length>t?e.substring(0,t)+"...":e:""},goToAnalysis(e){this.$router.push("/analysis"),this.$store.selectedRecordIndex=e}}},ve=(0,f.A)(pe,[["render",ge],["__scopeId","data-v-13f438a3"]]),ke=ve,ye={class:"analysis-container"},be={class:"history-selector mb-4"},Le={class:"history-header"},Re=["value"],fe={key:0,class:"history-manager"},Ce={class:"history-manager-content"},Ee={class:"history-manager-header"},Te={class:"history-manager-body"},_e={class:"history-list"},we={class:"history-item-content"},xe={class:"history-item-date"},Se={class:"history-item-thought"},Xe={class:"history-item-actions"},Ie=["onClick"],$e={key:0,class:"no-records"},Me={class:"history-manager-footer"},Oe={key:1,class:"card"},Be={class:"analysis-section"},Fe={class:"thought-text"},We={key:0,class:"situation-box"},Qe={class:"situation-text"},Pe={class:"meta-info"},Ae={class:"date-tag"},Ne={class:"emotion-badges"},je={class:"analysis-section"},ze={key:0,class:"bias-tags"},Je=["onClick"],Ke={class:"confidence"},De={key:1,class:"no-biases"},Ve={key:0},He={key:1,class:"bias-tips"},Ue={key:2},qe={key:2,class:"bias-evidence"},Ye={class:"evidence-header"},Ge={class:"evidence-text"},Ze={class:"analysis-section"},et={class:"question-list"},tt={key:0,class:"no-questions"},st={class:"analysis-section"},ot={key:0,class:"analysis-section"},at={class:"alternative-thought"},nt={class:"feedback-buttons"},it={key:1,class:"action-buttons"},lt={key:2,class:"loading-container"},rt={class:"progress"},ct={class:"loading-text"},dt={key:0,class:"loading-tips"},ut={key:3,class:"api-error alert alert-danger"},ht={class:"mt-2"},mt={key:2,class:"alert alert-warning"};function gt(e,t,s,a,n,i){const l=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",ye,[t[23]||(t[23]=(0,r.Lk)("h2",{class:"section-title"},"🔍 认知分析",-1)),(0,r.Lk)("div",be,[(0,r.Lk)("div",Le,[t[11]||(t[11]=(0,r.Lk)("label",{for:"recordSelect"},"选择记录:",-1)),(0,r.Lk)("button",{class:"btn btn-sm btn-outline-secondary",onClick:t[0]||(t[0]=e=>n.showHistoryManager=!0)},t[10]||(t[10]=[(0,r.Lk)("span",{class:"btn-icon"},"📋",-1),(0,r.eW)(" 管理历史记录 ")]))]),(0,r.bo)((0,r.Lk)("select",{id:"recordSelect",class:"form-select","onUpdate:modelValue":t[1]||(t[1]=e=>n.selectedRecordIndex=e),onChange:t[2]||(t[2]=(...e)=>i.loadSelectedRecord&&i.loadSelectedRecord(...e))},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.$store.state.thoughtRecords,((e,t)=>((0,r.uX)(),(0,r.CE)("option",{key:t,value:t},(0,c.v_)(i.formatTimestamp(e.timestamp))+" - "+(0,c.v_)(i.truncateText(e.automaticThought,30)),9,Re)))),128))],544),[[o.u1,n.selectedRecordIndex]])]),n.showHistoryManager?((0,r.uX)(),(0,r.CE)("div",fe,[(0,r.Lk)("div",Ce,[(0,r.Lk)("div",Ee,[t[12]||(t[12]=(0,r.Lk)("h3",null,"管理历史记录",-1)),(0,r.Lk)("button",{class:"btn-close",onClick:t[3]||(t[3]=e=>n.showHistoryManager=!1)},"×")]),(0,r.Lk)("div",Te,[(0,r.Lk)("div",_e,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.$store.state.thoughtRecords,((e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"history-item"},[(0,r.Lk)("div",we,[(0,r.Lk)("div",xe,(0,c.v_)(i.formatTimestamp(e.timestamp)),1),(0,r.Lk)("div",Se,(0,c.v_)(i.truncateText(e.automaticThought,60)),1),(0,r.Lk)("div",{class:(0,c.C4)(["history-item-status",i.getRecordStatusClass(e)])},(0,c.v_)(i.getRecordStatus(e)),3)]),(0,r.Lk)("div",Xe,[(0,r.Lk)("button",{class:"btn btn-sm btn-outline-danger",onClick:e=>i.deleteRecord(t),title:"删除记录"}," 🗑️ ",8,Ie)])])))),128)),0===e.$store.state.thoughtRecords.length?((0,r.uX)(),(0,r.CE)("div",$e," 暂无历史记录 ")):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",Me,[(0,r.Lk)("button",{class:"btn btn-outline-secondary",onClick:t[4]||(t[4]=e=>n.showHistoryManager=!1)},"关闭")])])])):(0,r.Q3)("",!0),n.currentRecord?((0,r.uX)(),(0,r.CE)("div",Oe,[(0,r.Lk)("div",Be,[t[14]||(t[14]=(0,r.Lk)("h5",null,"📌 你的自动思维",-1)),(0,r.Lk)("p",Fe,'"'+(0,c.v_)(n.currentRecord.automaticThought)+'"',1),n.currentRecord.situation?((0,r.uX)(),(0,r.CE)("div",We,[t[13]||(t[13]=(0,r.Lk)("h6",null,"🔍 情境描述",-1)),(0,r.Lk)("p",Qe,(0,c.v_)(n.currentRecord.situation),1)])):(0,r.Q3)("",!0),(0,r.Lk)("div",Pe,[(0,r.Lk)("span",Ae,(0,c.v_)(i.formatTimestamp(n.currentRecord.timestamp)),1),(0,r.Lk)("div",Ne,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.currentRecord.emotions,((e,t)=>((0,r.uX)(),(0,r.CE)("span",{key:t,class:"emotion-badge"},(0,c.v_)(e),1)))),128))])])]),(0,r.Lk)("div",je,[t[16]||(t[16]=(0,r.Lk)("h5",null,"🧠 识别到的认知偏差",-1)),n.analysisResult.cognitiveBiases&&n.analysisResult.cognitiveBiases.length>0?((0,r.uX)(),(0,r.CE)("div",ze,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.analysisResult.cognitiveBiases,(e=>((0,r.uX)(),(0,r.CE)("span",{class:"badge badge-pill",key:e.type,style:(0,c.Tr)({backgroundColor:i.getBiasColor(e.type)}),onClick:t=>i.selectBias(e)},[(0,r.eW)((0,c.v_)(e.type)+" ",1),(0,r.Lk)("span",Ke,"("+(0,c.v_)(e.confidence)+"%)",1)],12,Je)))),128))])):((0,r.uX)(),(0,r.CE)("div",De,[n.analyzedOnce?((0,r.uX)(),(0,r.CE)("p",Ve,"系统未检测到明显的认知偏差，但这并不意味着思维完全没有问题。 请继续浏览下方的引导性问题，思考自己的想法是否存在这些情况：")):(0,r.Q3)("",!0),n.analyzedOnce?((0,r.uX)(),(0,r.CE)("ul",He,t[15]||(t[15]=[(0,r.Lk)("li",null,"你是否在考虑最糟糕的可能性？",-1),(0,r.Lk)("li",null,'你是否在用"非黑即白"的方式看待情况？',-1),(0,r.Lk)("li",null,"你是否从单一事件得出了普遍性结论？",-1),(0,r.Lk)("li",null,"你是否用情绪而非事实在做判断？",-1),(0,r.Lk)("li",null,"你是否给自己或他人设置了过高标准？",-1)]))):((0,r.uX)(),(0,r.CE)("p",Ue,'暂未识别到认知偏差，请点击"开始分析"进行分析。'))])),n.selectedBias?((0,r.uX)(),(0,r.CE)("div",qe,[(0,r.Lk)("div",Ye,[(0,r.Lk)("h6",null,(0,c.v_)(n.selectedBias.type)+" 的识别依据：",1)]),(0,r.Lk)("p",Ge,(0,c.v_)(n.selectedBias.evidence),1)])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",Ze,[t[17]||(t[17]=(0,r.Lk)("h5",null,"💡 引导性问题",-1)),(0,r.Lk)("ul",et,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.analysisResult.guidingQuestions,((e,t)=>((0,r.uX)(),(0,r.CE)("li",{key:t},(0,c.v_)(e),1)))),128))]),n.analysisResult.guidingQuestions&&0!==n.analysisResult.guidingQuestions.length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",tt,' 暂无引导性问题，请点击"开始分析"生成问题。 '))]),(0,r.Lk)("div",st,[t[18]||(t[18]=(0,r.Lk)("h5",null,"📝 你的思考记录",-1)),(0,r.bo)((0,r.Lk)("textarea",{class:"form-control",rows:"4","onUpdate:modelValue":t[5]||(t[5]=e=>n.userResponse=e),placeholder:"请写下你对这些问题的思考..."},null,512),[[o.Jo,n.userResponse]])]),n.alternativeThought?((0,r.uX)(),(0,r.CE)("div",ot,[t[19]||(t[19]=(0,r.Lk)("h5",null,"🌈 建议的替代想法",-1)),(0,r.Lk)("p",at,'"'+(0,c.v_)(n.alternativeThought)+'"',1),(0,r.Lk)("div",nt,[(0,r.Lk)("button",{class:"btn btn-success mr-2",onClick:t[6]||(t[6]=(...e)=>i.saveAlternativeThought&&i.saveAlternativeThought(...e))}," 👍 保存这个想法 "),(0,r.Lk)("button",{class:"btn btn-outline-secondary",onClick:t[7]||(t[7]=(...e)=>i.generateAlternativeThought&&i.generateAlternativeThought(...e))}," 🔄 重新生成 ")])])):(0,r.Q3)("",!0),n.isLoading?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",it,[(0,r.Lk)("button",{class:"btn btn-primary",onClick:t[8]||(t[8]=(...e)=>i.analyzeThought&&i.analyzeThought(...e))},t[20]||(t[20]=[(0,r.Lk)("span",{class:"icon"},"🧠",-1),(0,r.eW)(" 开始分析 ")]))])),n.isLoading?((0,r.uX)(),(0,r.CE)("div",lt,[(0,r.Lk)("div",rt,[(0,r.Lk)("div",{class:(0,c.C4)(["progress-bar",{"progress-bar-animated":n.isLoading}]),style:(0,c.Tr)({width:`${n.loadingProgress}%`})},(0,c.v_)(n.loadingStage),7)]),(0,r.Lk)("p",ct,(0,c.v_)(n.loadingStage)+" ("+(0,c.v_)(n.loadingProgress)+"%)",1),n.loadingTip?((0,r.uX)(),(0,r.CE)("p",dt,(0,c.v_)(n.loadingTip),1)):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0),n.apiError?((0,r.uX)(),(0,r.CE)("div",ut,[t[22]||(t[22]=(0,r.Lk)("p",null,[(0,r.Lk)("strong",null,"分析过程中发生错误")],-1)),(0,r.Lk)("p",null,(0,c.v_)(n.apiError),1),(0,r.Lk)("p",ht,[(0,r.Lk)("button",{class:"btn btn-sm btn-outline-danger",onClick:t[9]||(t[9]=e=>n.apiError=null)},"关闭"),(0,r.bF)(l,{to:"/config",class:"btn btn-sm btn-primary ml-2"},{default:(0,r.k6)((()=>t[21]||(t[21]=[(0,r.eW)("检查API设置")]))),_:1})])])):(0,r.Q3)("",!0)])):((0,r.uX)(),(0,r.CE)("div",mt," ⚠️ 请先完成至少一条思想记录 "))])}var pt=s(335);const vt={data(){return{selectedRecordIndex:0,currentRecord:null,analysisResult:{cognitiveBiases:[],guidingQuestions:[]},userResponse:"",alternativeThought:"",isLoading:!1,loadingProgress:0,loadingStage:"准备分析",loadingTip:"",apiError:null,showHistoryManager:!1,selectedBias:null,analyzedOnce:!1,loadingTips:["认知偏差是我们思维中的盲点，识别它们是治疗的第一步...","苏格拉底式提问帮助我们挑战自己的想法，促进更深入的思考...","替代性思维不是简单地积极思考，而是寻找更平衡的视角...","认知行为疗法强调思维、情绪和行为之间的联系...","改变想法不是一蹴而就的，需要持续的练习和耐心..."]}},computed:{apiConfig(){return this.$store.state.apiConfig}},mounted(){void 0!==this.$store.selectedRecordIndex?(this.selectedRecordIndex=this.$store.selectedRecordIndex,this.$store.selectedRecordIndex=void 0):this.$store.state.thoughtRecords.length>0&&(this.selectedRecordIndex=0),this.loadSelectedRecord()},methods:{formatTimestamp(e){return e?new Date(e).toLocaleString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"未知时间"},truncateText(e,t){return e?e.length>t?e.substring(0,t)+"...":e:""},loadSelectedRecord(){if(0===this.$store.state.thoughtRecords.length)return void(this.currentRecord=null);const e=this.$store.state.thoughtRecords[this.selectedRecordIndex];this.currentRecord=e,e.analysisResult?this.analysisResult=e.analysisResult:this.analysisResult={cognitiveBiases:[],guidingQuestions:[]},e.userResponse?this.userResponse=e.userResponse:this.userResponse="",this.alternativeThought=e.alternativeThought||"",this.selectedBias=null},getBiasColor(e){const t={灾难化:"#ff6b6b",非黑即白:"#4ecdc4",过度概括:"#45b7d1",情绪推理:"#96ceb4",应该陈述:"#ffeead",心理过滤:"#ffb347",个人化:"#c06c84",控制谬误:"#7579e7",贴标签:"#84b1ed",读心术:"#d183c9"};return t[e]||"#6c757d"},selectBias(e){this.selectedBias===e?this.selectedBias=null:this.selectedBias=e},getRecordStatus(e){return e.alternativeThought?"已完成分析":e.analysisResult&&e.analysisResult.cognitiveBiases?"分析进行中":"待分析"},getRecordStatusClass(e){return e.alternativeThought?"status-completed":e.analysisResult&&e.analysisResult.cognitiveBiases?"status-progress":"status-pending"},deleteRecord(e){confirm("确定要删除这条记录吗？删除后无法恢复。")&&(this.$store.state.thoughtRecords.splice(e,1),this.$store.saveState(),this.selectedRecordIndex===e?(this.selectedRecordIndex=0,this.loadSelectedRecord()):this.selectedRecordIndex>e&&this.selectedRecordIndex--)},async analyzeThought(){this.isLoading=!0,this.loadingProgress=0,this.loadingStage="初始化分析",this.apiError=null,this.loadingTip=this.getRandomTip();try{this.loadingStage="识别认知偏差",this.loadingProgress=25,this.loadingTip=this.getRandomTip();const e=await this.callLLM(this.getBiasPrompt());this.analysisResult.cognitiveBiases=this.parseBiasResponse(e),this.analyzedOnce=!0,this.loadingStage="生成引导问题",this.loadingProgress=50,this.loadingTip=this.getRandomTip();const t=await this.callLLM(this.getQuestionPrompt());this.analysisResult.guidingQuestions=this.parseQuestionResponse(t),this.$store.state.thoughtRecords[this.selectedRecordIndex].userResponse=this.userResponse,this.$store.state.thoughtRecords[this.selectedRecordIndex].analysisResult=this.analysisResult,this.$store.saveState(),this.loadingStage="生成替代想法",this.loadingProgress=75,this.loadingTip=this.getRandomTip(),await this.generateAlternativeThought()}catch(e){console.error("分析失败:",e),this.apiError=e.message||"分析过程中发生未知错误，请重试"}finally{this.loadingProgress=100,this.loadingStage="分析完成",this.loadingTip=null,setTimeout((()=>{this.isLoading=!1}),500)}},async generateAlternativeThought(){this.isLoading||(this.isLoading=!0,this.loadingProgress=0,this.loadingStage="生成替代想法");try{this.loadingProgress=50;const e=await this.callLLM(this.getAlternativeThoughtPrompt());this.alternativeThought=e.choices[0].message.content,this.loadingProgress=100}catch(e){console.error("生成替代想法失败:",e)}finally{setTimeout((()=>{this.isLoading=!1}),500)}},async callLLM(e){try{const t={"Content-Type":"application/json"},s="/api/llm-proxy",o={prompt:e};console.log(`正在调用代理服务: ${s}`);const a=await pt.A.post(s,o,{headers:t,timeout:45e3});return a.data}catch(t){if(console.error("调用代理服务失败:",t),t.response){console.error("代理服务响应:",t.response.data);const e=t.response.data?.error||(t.response.data?.details?`代理错误: ${t.response.data.details}`:`代理服务返回错误: ${t.response.status}`);throw new Error(e)}throw t.request?new Error("未收到代理服务响应，请检查网络连接或稍后重试"):new Error(`请求配置错误: ${t.message}`)}},getBiasPrompt(){let e="请作为一名专业的认知行为治疗师，仔细分析以下内容中可能存在的认知偏差。\n  \n认知偏差是人们在思考过程中出现的系统性错误或模式，往往导致非理性判断和决策。";return this.currentRecord.situation&&(e+=`\n\n情境描述：${this.currentRecord.situation}`),e+=`\n\n自动思维："${this.currentRecord.automaticThought}"`,this.currentRecord.emotions&&this.currentRecord.emotions.length>0&&(e+=`\n\n伴随情绪：${this.currentRecord.emotions.join("、")}（强度：${this.currentRecord.intensity}%）`),e+='\n\n请识别出上述内容中存在的认知偏差，并严格按照以下JSON格式返回（不要有任何额外文字）：\n{\n  "biases": [\n    {\n      "type": "偏差类型名称",\n      "confidence": 置信度百分比（例如85，不要带%符号）,\n      "evidence": "详细说明为什么这属于该种偏差的文本依据"\n    }\n  ]\n}\n\n常见的认知偏差类型包括：\n1. 灾难化：过分夸大负面事件的后果\n2. 非黑即白：将事物简化为两个极端类别\n3. 过度概括：从单一事件中得出普遍结论\n4. 情绪推理：根据情绪状态而非客观事实做判断\n5. 应该陈述：用刚性的规则要求自己或他人\n6. 心理过滤：只关注负面细节而忽视积极方面\n7. 个人化：不合理地将外部事件归因于自己\n8. 控制谬误：认为应当能控制所有事情\n9. 贴标签：用简单标签概括复杂情况\n10. 读心术：假设知道他人的想法或感受\n\n如果没有发现明显的认知偏差，请返回空数组：{"biases": []}',e},getQuestionPrompt(){let e="作为一名专业的认知行为治疗师，请针对以下内容设计3个有效的苏格拉底式引导问题，帮助当事人质疑和挑战自己的思维模式。";return this.currentRecord.situation&&(e+=`\n\n情境描述：${this.currentRecord.situation}`),e+=`\n\n自动思维："${this.currentRecord.automaticThought}"`,this.currentRecord.emotions&&this.currentRecord.emotions.length>0&&(e+=`\n\n伴随情绪：${this.currentRecord.emotions.join("、")}`),this.analysisResult.cognitiveBiases&&this.analysisResult.cognitiveBiases.length>0&&(e+=`\n\n识别到的认知偏差：${this.analysisResult.cognitiveBiases.map((e=>e.type)).join("、")}`),e+='\n\n请设计3个开放式的苏格拉底式问题，这些问题应该：\n1. 鼓励深度思考而非简单的是/否回答\n2. 帮助挑战非理性信念\n3. 引导探索替代性解释\n4. 使用温和而尊重的语气\n5. 针对当事人的具体情况而非泛泛而谈\n\n请只返回问题本身的JSON数组格式（不要有任何额外说明）：\n["问题1", "问题2", "问题3"]',e},getAlternativeThoughtPrompt(){let e="作为一名认知行为治疗师，请根据以下信息，生成一个更加平衡、理性的替代思维。";return this.currentRecord.situation&&(e+=`\n\n情境描述：${this.currentRecord.situation}`),e+=`\n\n原始自动思维："${this.currentRecord.automaticThought}"`,this.currentRecord.emotions&&this.currentRecord.emotions.length>0&&(e+=`\n\n伴随情绪：${this.currentRecord.emotions.join("、")}`),this.analysisResult.cognitiveBiases&&this.analysisResult.cognitiveBiases.length>0&&(e+=`\n\n识别到的认知偏差：${this.analysisResult.cognitiveBiases.map((e=>e.type)).join("、")}`),e+=`\n\n用户对引导问题的思考：${this.userResponse||"(用户尚未填写)"}`,e+="\n\n请生成一个更加平衡和理性的替代思维，应该：\n1. 用第一人称表达，就像当事人自己在说话\n2. 使用口语化、自然的中文表达\n3. 保持温暖、支持和鼓励的语气\n4. 承认事实，但提供更加平衡和有建设性的视角\n5. 长度适中，通常为2-4句话\n\n请直接返回替代思维内容，不要包含任何额外的解释或说明。",e},parseBiasResponse(e){try{const o=e.choices[0].message.content;try{const e=JSON.parse(o);if(e&&e.biases)return e.biases}catch(t){console.error("解析偏差JSON失败:",t);const e=o.match(/\{[\s\S]*\}/);if(e)try{const t=JSON.parse(e[0]);if(t&&t.biases)return t.biases}catch(s){console.error("提取JSON后解析仍然失败:",s)}}return console.warn("无法从LLM响应中解析出认知偏差数据，原始响应:",o),[]}catch(o){return console.error("解析偏差响应失败:",o),[]}},parseQuestionResponse(e){try{const o=e.choices[0].message.content;try{const e=JSON.parse(o);if(Array.isArray(e))return e}catch(t){console.error("解析问题JSON失败:",t);const e=o.match(/\[[\s\S]*\]/);if(e)try{const t=JSON.parse(e[0]);if(Array.isArray(t))return t}catch(s){console.error("提取数组后解析仍然失败:",s)}}if(o.includes("\n")){const e=o.split("\n").filter((e=>e.trim()&&!e.startsWith("[")&&!e.startsWith("]")&&!e.startsWith("```")));if(e.length>0)return e.map((e=>e.replace(/^[0-9]+[\.\)]\s*/,"").trim())).filter((e=>e))}return console.warn("无法从LLM响应中解析出问题数据，原始响应:",o),[]}catch(o){return console.error("解析问题响应失败:",o),[]}},saveAlternativeThought(){this.$store.state.thoughtRecords[this.selectedRecordIndex].alternativeThought=this.alternativeThought,this.$store.state.thoughtRecords[this.selectedRecordIndex].userResponse=this.userResponse,this.$store.saveState(),alert("替代想法已保存！")},getRandomTip(){return this.loadingTips[Math.floor(Math.random()*this.loadingTips.length)]}}},kt=(0,f.A)(vt,[["render",gt],["__scopeId","data-v-d1a01a10"]]),yt=kt,bt={class:"dashboard"},Lt={class:"welcome-header"},Rt={key:0,class:"last-record"},ft={class:"dashboard-grid stats-section"},Ct={class:"stat-card total-records"},Et={class:"stat-content"},Tt={class:"stat-number"},_t={class:"stat-card analyzed-records"},wt={class:"stat-content"},xt={class:"stat-number"},St={class:"stat-card mood-trend"},Xt={class:"stat-content"},It={class:"dashboard-grid actions-section"},$t={class:"action-content"},Mt={class:"action-desc"},Ot={class:"action-content"},Bt={class:"action-desc"},Ft={key:0,class:"recent-records"},Wt={class:"section-title"},Qt={class:"dashboard-grid records-section"},Pt=["onClick"],At={class:"record-header"},Nt={class:"record-date"},jt={class:"record-emotions"},zt={key:0,class:"emotion-more"},Jt={class:"record-thought"},Kt={class:"dashboard-grid charts-section"},Dt={class:"chart-card emotion-stats"},Vt={class:"chart-card-header"},Ht={key:0,class:"stat-card-actions"},Ut={class:"emotion-count-badge"},qt={key:0,class:"chart-content emotion-chart"},Yt={class:"chart-label"},Gt={class:"emotion-emoji"},Zt={class:"emotion-name"},es={class:"chart-bar-container"},ts={class:"chart-value"},ss={key:1,class:"no-data"},os={class:"chart-card bias-stats"},as={class:"chart-card-header"},ns={key:0,class:"stat-card-actions"},is={class:"bias-count-badge"},ls={key:0,class:"chart-content bias-chart"},rs={class:"chart-label"},cs={class:"bias-name"},ds={class:"chart-bar-container"},us={class:"chart-value"},hs={key:1,class:"no-data"},ms={__name:"Dashboard",setup(e){const{t}=(0,n.s9)(),s=(0,r.WQ)("store"),o=(0,a.rd)(),i=(0,r.EW)((()=>s.state.thoughtRecords.length)),l=(0,r.EW)((()=>s.state.thoughtRecords[0])),u=(0,r.EW)((()=>i.value>0)),h=(0,r.EW)((()=>s.state.thoughtRecords.filter((e=>e.alternativeThought)).length)),m=(0,r.EW)((()=>s.state.thoughtRecords.slice(0,3))),g=(0,r.EW)((()=>{const e=i.value;return u.value?t("dashboard.analysisSummary",{count:e}):t("dashboard.analysisPrompt")})),p=(0,r.EW)((()=>{const e=s.state.thoughtRecords.slice(0,5);if(e.length<2)return{label:t("dashboard.trendInsufficientData"),class:"neutral"};const o=e.slice(0,Math.ceil(e.length/2)).reduce(((e,t)=>e+(t.intensity||50)),0)/Math.ceil(e.length/2),a=e.slice(Math.ceil(e.length/2)).reduce(((e,t)=>e+(t.intensity||50)),0)/Math.floor(e.length/2),n=o-a;return n<-5?{label:t("dashboard.trendImproving"),class:"positive"}:n>5?{label:t("dashboard.trendFluctuating"),class:"negative"}:{label:t("dashboard.trendStable"),class:"neutral"}})),v=(0,r.EW)((()=>{const e=s.state.thoughtRecords.flatMap((e=>e.emotions||[]));return e.reduce(((e,t)=>(e[t]=(e[t]||0)+1,e)),{})})),k=(0,r.EW)((()=>Math.max(...Object.values(v.value||{}),1))),y=(0,r.EW)((()=>Object.entries(v.value).sort(((e,t)=>t[1]-e[1])).reduce(((e,[t,s])=>(e[t]=s,e)),{}))),b=(0,r.EW)((()=>t("dashboard.chartEmotionCount",{count:Object.keys(v.value).length}))),L=(0,r.EW)((()=>{const e=s.state.thoughtRecords.flatMap((e=>(e.analysisResult||{}).cognitiveBiases||[])).map((e=>e.type));return Object.entries(e.reduce(((e,t)=>(e[t]=(e[t]||0)+1,e)),{})).sort(((e,t)=>t[1]-e[1])).slice(0,5).map((([e,t])=>({type:e,count:t})))})),R=(0,r.EW)((()=>L.value.length>0?Math.max(...L.value.map((e=>e.count)),1):1)),f=()=>L.value.reduce(((e,t)=>e+t.count),0),C=(0,r.EW)((()=>t("dashboard.chartBiasCount",{count:f()}))),E=e=>e?new Date(e).toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):t("dashboard.unknownTime"),T=(e,t)=>e?e.length>t?e.slice(0,t)+"...":e:"",_=e=>e.alternativeThought?t("dashboard.statusCompleted"):e.analysisResult&&(e.analysisResult.cognitiveBiases&&e.analysisResult.cognitiveBiases.length>0||e.analysisResult.guidingQuestions&&e.analysisResult.guidingQuestions.length>0)?t("dashboard.statusInProgress"):t("dashboard.statusPending"),w=e=>e.alternativeThought?"status-completed":e.analysisResult&&(e.analysisResult.cognitiveBiases&&e.analysisResult.cognitiveBiases.length>0||e.analysisResult.guidingQuestions&&e.analysisResult.guidingQuestions.length>0)?"status-progress":"status-pending",x=e=>{s.selectedRecordIndex=e,o.push("/analysis")},S=e=>{const t={焦虑:"😰",沮丧:"😔",愤怒:"😠",悲伤:"😢",羞愧:"😳",兴奋:"😃",平静:"😌",恐惧:"😨",失落:"😞",担忧:"😟",自责:"😓",困惑:"🤔",无助:"🥺"};return t[e]||"😶"},X=e=>{const t={灾难化:"#ff6b6b",非黑即白:"#4ecdc4",过度概括:"#45b7d1",情绪推理:"#96ceb4",应该陈述:"#ffeead",心理过滤:"#ffb347",个人化:"#c06c84",控制谬误:"#7579e7",贴标签:"#84b1ed",读心术:"#d183c9"};return t[e]||"#6c757d"},I=e=>{const t=X(e);return t.replace(")",", 0.3)").replace("rgb","rgba")},$={焦虑:"common.emotions.anxiety",沮丧:"common.emotions.depression",愤怒:"common.emotions.anger",悲伤:"common.emotions.sadness",羞愧:"common.emotions.shame",兴奋:"common.emotions.excitement",平静:"common.emotions.calm",恐惧:"common.emotions.fear",失落:"common.emotions.loss",担忧:"common.emotions.worry",自责:"common.emotions.selfBlame",困惑:"common.emotions.confusion",无助:"common.emotions.helplessness"},M=e=>{const s=$[e]||e;return s.includes(".")?t(s):s},O={灾难化:"common.biases.catastrophizing",非黑即白:"common.biases.allOrNothing",过度概括:"common.biases.overgeneralization",情绪推理:"common.biases.emotionalReasoning",应该陈述:"common.biases.shouldStatements",心理过滤:"common.biases.mentalFilter",个人化:"common.biases.personalization",控制谬误:"common.biases.controlFallacy",贴标签:"common.biases.labeling",读心术:"common.biases.mindReading"},B=e=>{const s=O[e]||e;return s.includes(".")?t(s):s};return(e,s)=>{const o=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",bt,[(0,r.Lk)("header",Lt,[(0,r.Lk)("h1",null,(0,c.v_)((0,d.R1)(t)("dashboard.welcome")),1),l.value?((0,r.uX)(),(0,r.CE)("p",Rt,(0,c.v_)((0,d.R1)(t)("dashboard.lastRecordPrefix"))+(0,c.v_)(E(l.value.timestamp)),1)):(0,r.Q3)("",!0)]),(0,r.Lk)("section",ft,[(0,r.Lk)("div",Ct,[s[0]||(s[0]=(0,r.Lk)("div",{class:"stat-icon"},"📊",-1)),(0,r.Lk)("div",Et,[(0,r.Lk)("h4",null,(0,c.v_)((0,d.R1)(t)("dashboard.statTotalRecords")),1),(0,r.Lk)("div",Tt,(0,c.v_)(i.value),1)])]),(0,r.Lk)("div",_t,[s[1]||(s[1]=(0,r.Lk)("div",{class:"stat-icon"},"🧠",-1)),(0,r.Lk)("div",wt,[(0,r.Lk)("h4",null,(0,c.v_)((0,d.R1)(t)("dashboard.statAnalyzedRecords")),1),(0,r.Lk)("div",xt,(0,c.v_)(h.value),1)])]),(0,r.Lk)("div",St,[s[2]||(s[2]=(0,r.Lk)("div",{class:"stat-icon"},"😊",-1)),(0,r.Lk)("div",Xt,[(0,r.Lk)("h4",null,(0,c.v_)((0,d.R1)(t)("dashboard.statMoodTrend")),1),(0,r.Lk)("div",{class:(0,c.C4)(["trend-indicator",p.value.class])},(0,c.v_)(p.value.label),3)])])]),(0,r.Lk)("section",It,[(0,r.bF)(o,{to:"/record",class:"action-card new-record"},{default:(0,r.k6)((()=>[(0,r.Lk)("div",$t,[s[3]||(s[3]=(0,r.Lk)("span",{class:"icon"},"📝",-1)),(0,r.Lk)("h3",null,(0,c.v_)((0,d.R1)(t)("dashboard.actionNewRecord")),1),(0,r.Lk)("p",Mt,(0,c.v_)((0,d.R1)(t)("dashboard.actionNewRecordDesc")),1)])])),_:1}),(0,r.bF)(o,{to:"/analysis",class:(0,c.C4)(["action-card view-analysis",{disabled:!u.value}])},{default:(0,r.k6)((()=>[(0,r.Lk)("div",Ot,[s[4]||(s[4]=(0,r.Lk)("span",{class:"icon"},"🔍",-1)),(0,r.Lk)("h3",null,(0,c.v_)((0,d.R1)(t)("dashboard.actionViewAnalysis")),1),(0,r.Lk)("p",Bt,(0,c.v_)(g.value),1)])])),_:1},8,["class"])]),u.value?((0,r.uX)(),(0,r.CE)("section",Ft,[(0,r.Lk)("h2",Wt,(0,c.v_)((0,d.R1)(t)("dashboard.recentRecordsTitle")),1),(0,r.Lk)("div",Qt,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(m.value,((e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"record-card",onClick:e=>x(t)},[(0,r.Lk)("div",At,[(0,r.Lk)("div",Nt,(0,c.v_)(E(e.timestamp)),1),(0,r.Lk)("div",jt,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.emotions.slice(0,2),((e,t)=>((0,r.uX)(),(0,r.CE)("span",{key:t,class:"emotion-tag"},(0,c.v_)(M(e)),1)))),128)),e.emotions.length>2?((0,r.uX)(),(0,r.CE)("span",zt,"+"+(0,c.v_)(e.emotions.length-2),1)):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",Jt,(0,c.v_)(T(e.automaticThought,80)),1),(0,r.Lk)("div",{class:(0,c.C4)(["record-status",w(e)])},(0,c.v_)(_(e)),3)],8,Pt)))),128))])])):(0,r.Q3)("",!0),(0,r.Lk)("section",Kt,[(0,r.Lk)("div",Dt,[(0,r.Lk)("div",Vt,[(0,r.Lk)("h5",null,[s[5]||(s[5]=(0,r.Lk)("span",{class:"stat-icon-small"},"📊",-1)),(0,r.eW)(" "+(0,c.v_)((0,d.R1)(t)("dashboard.chartEmotionTitle")),1)]),u.value?((0,r.uX)(),(0,r.CE)("div",Ht,[(0,r.Lk)("div",Ut,(0,c.v_)(b.value),1)])):(0,r.Q3)("",!0)]),Object.keys(v.value).length>0?((0,r.uX)(),(0,r.CE)("div",qt,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(y.value,((e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"chart-item"},[(0,r.Lk)("div",Yt,[(0,r.Lk)("span",Gt,(0,c.v_)(S(t)),1),(0,r.Lk)("span",Zt,(0,c.v_)(M(t)),1)]),(0,r.Lk)("div",es,[(0,r.Lk)("div",{class:"chart-bar",style:(0,c.Tr)({width:e/k.value*100+"%"})},null,4),(0,r.Lk)("span",ts,(0,c.v_)(e),1)])])))),128))])):((0,r.uX)(),(0,r.CE)("div",ss,(0,c.v_)((0,d.R1)(t)("dashboard.chartEmotionEmpty")),1))]),(0,r.Lk)("div",os,[(0,r.Lk)("div",as,[(0,r.Lk)("h5",null,[s[6]||(s[6]=(0,r.Lk)("span",{class:"stat-icon-small"},"⚠️",-1)),(0,r.eW)(" "+(0,c.v_)((0,d.R1)(t)("dashboard.chartBiasTitle")),1)]),L.value.length>0?((0,r.uX)(),(0,r.CE)("div",ns,[(0,r.Lk)("div",is,(0,c.v_)(C.value),1)])):(0,r.Q3)("",!0)]),L.value.length>0?((0,r.uX)(),(0,r.CE)("div",ls,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(L.value,((e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"chart-item"},[(0,r.Lk)("div",rs,[(0,r.Lk)("span",{class:"bias-icon",style:(0,c.Tr)({backgroundColor:X(e.type)})},null,4),(0,r.Lk)("span",cs,(0,c.v_)(B(e.type)),1)]),(0,r.Lk)("div",ds,[(0,r.Lk)("div",{class:"chart-bar bias-bar",style:(0,c.Tr)({width:e.count/R.value*100+"%",background:`linear-gradient(to right, ${I(e.type)}, ${X(e.type)})`})},null,4),(0,r.Lk)("span",us,(0,c.v_)(e.count),1)])])))),128))])):((0,r.uX)(),(0,r.CE)("div",hs,(0,c.v_)((0,d.R1)(t)("dashboard.chartBiasEmpty")),1))])])])}}},gs=(0,f.A)(ms,[["__scopeId","data-v-b74af2d2"]]),ps=gs,vs=(0,a.aE)({history:(0,a.LA)(),routes:[{path:"/",component:ps},{path:"/config",component:F},{path:"/record",component:ke},{path:"/analysis",component:yt}]}),ks=()=>{const e=localStorage.getItem("userLocale");return e||"sc"},ys=(0,n.hU)({legacy:!1,locale:ks(),fallbackLocale:"sc",messages:{sc:i,tc:l}}),bs={state:{apiConfig:{endpoint:"https://api.openai.com/v1/chat/completions",apiKey:"",model:"gpt-3.5-turbo"},thoughtRecords:[],selectedRecordIndex:void 0,currentLocale:ks()},saveState(){localStorage.setItem("cbtHelperState",JSON.stringify(this.state)),localStorage.setItem("userLocale",this.state.currentLocale)},restoreState(){const e=localStorage.getItem("cbtHelperState");if(e)try{const t=JSON.parse(e);this.state={...this.state,...t,apiConfig:{...this.state.apiConfig,...t.apiConfig},currentLocale:localStorage.getItem("userLocale")||"sc"}}catch(t){console.error("恢复状态失败:",t)}ys.global.locale.value=this.state.currentLocale},setLocale(e){["sc","tc"].includes(e)?(this.state.currentLocale=e,ys.global.locale.value=e,this.saveState()):console.warn(`Unsupported locale: ${e}`)},clearAll(){this.state.thoughtRecords=[],this.saveState()}};bs.restoreState();const Ls=(0,o.Ef)(E);Ls.use(vs),Ls.use(ys),Ls.provide("store",bs),Ls.mount("#app")}},t={};function s(o){var a=t[o];if(void 0!==a)return a.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,s),n.exports}s.m=e,(()=>{var e=[];s.O=(t,o,a,n)=>{if(!o){var i=1/0;for(d=0;d<e.length;d++){for(var[o,a,n]=e[d],l=!0,r=0;r<o.length;r++)(!1&n||i>=n)&&Object.keys(s.O).every((e=>s.O[e](o[r])))?o.splice(r--,1):(l=!1,n<i&&(i=n));if(l){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[o,a,n]}})(),(()=>{s.d=(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}})(),(()=>{s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{s.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{var e={524:0};s.O.j=t=>0===e[t];var t=(t,o)=>{var a,n,[i,l,r]=o,c=0;if(i.some((t=>0!==e[t]))){for(a in l)s.o(l,a)&&(s.m[a]=l[a]);if(r)var d=r(s)}for(t&&t(o);c<i.length;c++)n=i[c],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(d)},o=self["webpackChunkcbthelper"]=self["webpackChunkcbthelper"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var o=s.O(void 0,[504],(()=>s(522)));o=s.O(o)})();
//# sourceMappingURL=app.8c259c36.js.map